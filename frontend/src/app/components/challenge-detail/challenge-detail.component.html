<div class="challenge-detail-container fade-in" *ngIf="challenge">
    <!-- Header Section -->
    <div class="challenge-header">
        <div class="header-content">
            <span class="status-badge" [ngClass]="challenge.status?.toLowerCase() || 'active'">
                {{ challenge.status || 'Active' }}
            </span>
            <h1>{{ challenge.name || challenge.title }}</h1>
            <p class="description">{{ challenge.description || 'No description provided' }}</p>

            <div class="meta-grid">
                <div class="meta-item">
                    <i class="fas fa-bullseye"></i>
                    <span>Goal: {{ challenge.goal_amount | number }} words</span>
                </div>
                <div class="meta-item">
                    <i class="fas fa-calendar-alt"></i>
                    <span>{{ challenge.start_date | date:'mediumDate' }} - {{ challenge.end_date | date:'mediumDate' }}</span>
                </div>
                <div class="meta-item">
                    <i class="fas fa-clock"></i>
                    <span>{{ challenge.days_remaining }} days remaining</span>
                </div>
                <div class="meta-item">
                    <i class="fas fa-users"></i>
                    <span>{{ participants.length }} participants</span>
                </div>
                <div class="meta-item">
                    <i class="fas" [ngClass]="challenge.is_public ? 'fa-globe' : 'fa-lock'"></i>
                    <span>{{ challenge.is_public ? 'Public' : 'Private' }}</span>
                </div>
            </div>

            <!-- Invite Code -->
            <div class="invite-section" *ngIf="challenge.invite_code">
                <p>Invite Code: <span class="code">{{ challenge.invite_code }}</span></p>
                <button class="btn-icon" (click)="copyCode()" title="Copy Code">
                    <i class="fas fa-copy"></i>
                </button>
            </div>
        </div>

        <!-- User Progress Card -->
        <div class="user-progress-card">
            <h3>Your Progress</h3>
            <div class="progress-circle">
                <svg viewBox="0 0 36 36" class="circular-chart">
                    <path class="circle-bg"
                        d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" />
                    <path class="circle"
                        [attr.stroke-dasharray]="getPercent(userProgress, challenge.goal_amount) + ', 100'"
                        d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" />
                </svg>
                <div class="percentage">
                    {{ getPercent(userProgress, challenge.goal_amount) }}%
                </div>
            </div>
            <p class="progress-text">{{ userProgress | number }} / {{ challenge.goal_amount | number }} words</p>

            <!-- Update Progress Form -->
            <div class="log-words-form">
                <label>Update your total word count:</label>
                <div class="input-group">
                    <input type="number" [(ngModel)]="newProgress" [placeholder]="'Current: ' + userProgress" min="0">
                    <button class="btn-primary" (click)="updateProgress()" 
                        [disabled]="newProgress === null || newProgress < 0 || isUpdatingProgress">
                        <i class="fas" [ngClass]="isUpdatingProgress ? 'fa-spinner fa-spin' : 'fa-save'"></i>
                        {{ isUpdatingProgress ? 'Saving...' : 'Update' }}
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="dashboard-grid">
        <!-- Leaderboard -->
        <div class="section leaderboard">
            <h3><i class="fas fa-trophy"></i> Leaderboard</h3>
            <div class="leaderboard-list" *ngIf="participants.length > 0; else noParticipants">
                <div class="participant-row" *ngFor="let p of participants; let i = index"
                    [class.current-user]="isCurrentUser(p)"
                    [class.top-three]="i < 3">
                    <div class="rank" [class.gold]="i === 0" [class.silver]="i === 1" [class.bronze]="i === 2">
                        <span *ngIf="i === 0">ðŸ¥‡</span>
                        <span *ngIf="i === 1">ðŸ¥ˆ</span>
                        <span *ngIf="i === 2">ðŸ¥‰</span>
                        <span *ngIf="i > 2">{{ i + 1 }}</span>
                    </div>
                    <div class="info">
                        <span class="name">{{ p.username }}</span>
                        <span class="you-badge" *ngIf="isCurrentUser(p)">(You)</span>
                    </div>
                    <div class="score">
                        <span class="word-count">{{ p.current_progress | number }}</span>
                        <span class="unit">words</span>
                    </div>
                    <div class="progress-mini">
                        <div class="progress-bar" [style.width.%]="getPercent(p.current_progress, challenge.goal_amount)"></div>
                    </div>
                </div>
            </div>
            <ng-template #noParticipants>
                <div class="empty-state">No participants yet. Be the first!</div>
            </ng-template>
        </div>

        <!-- Challenge Info -->
        <div class="section info-panel">
            <h3><i class="fas fa-info-circle"></i> Challenge Info</h3>
            <div class="info-list">
                <div class="info-item">
                    <span class="label">Type</span>
                    <span class="value">{{ challenge.type || 'Word Count' }}</span>
                </div>
                <div class="info-item">
                    <span class="label">Duration</span>
                    <span class="value">{{ challenge.duration_days || 30 }} days</span>
                </div>
                <div class="info-item">
                    <span class="label">Created</span>
                    <span class="value">{{ challenge.created_at | date:'mediumDate' }}</span>
                </div>
                <div class="info-item" *ngIf="challenge.is_joined">
                    <span class="label">Status</span>
                    <span class="value joined">âœ“ Joined</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Actions -->
    <div class="actions-footer">
        <a routerLink="/challenges" class="btn-secondary">
            <i class="fas fa-arrow-left"></i> Back to Challenges
        </a>
        <button class="btn-danger" (click)="leaveChallenge()" *ngIf="challenge.is_joined">
            <i class="fas fa-sign-out-alt"></i> Leave Challenge
        </button>
    </div>

</div>

<app-content-loader *ngIf="isLoading"></app-content-loader>
