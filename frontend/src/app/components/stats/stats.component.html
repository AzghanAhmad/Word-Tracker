<div class="stats-container">
    <app-content-loader *ngIf="isLoading"></app-content-loader>

    <div class="content" *ngIf="!isLoading">
        <div class="header">
            <h1><i class="fas fa-chart-pie"></i> Writing Insights</h1>
            <p>Visualize your habits and progress over time.</p>
        </div>

        <!-- Key Metrics Cards - EXACT Create Plan Design -->
        <div class="metrics-grid">
            <div class="metric-card">
                <div class="stat-value">{{ currentStreak }}</div>
                <div class="stat-label">Current Streak (days) <i class="fas fa-star"></i></div>
            </div>
            <div class="metric-card">
                <div class="stat-value">{{ bestDay | number }}</div>
                <div class="stat-label">Best Day (words) <i class="fas fa-star"></i></div>
            </div>
            <div class="metric-card">
                <div class="stat-value">{{ totalWords | number }}</div>
                <div class="stat-label">Total Written (words) <i class="fas fa-star"></i></div>
            </div>
            <div class="metric-card">
                <div class="stat-value">{{ weeklyAvg | number }}</div>
                <div class="stat-label">Weekly Avg (words) <i class="fas fa-star"></i></div>
            </div>
        </div>

        <!-- Overall Growth (Line Chart) -->
        <div class="chart-card line-chart-card">
            <div class="card-header">
                <div class="title-group">
                    <h3>Overall Growth</h3>
                    <p class="subtitle">Tracks cumulative progress starting from your first plan</p>
                </div>
                <div class="chart-legend">
                    <span class="dot progress-dot"></span> Your Progress
                    <span class="dot target-dot"></span> Planned Target
                </div>
            </div>
            <app-output-stats-chart [data]="allDaysDataForChart"
                [initialCount]="initialChartCount"></app-output-stats-chart>
        </div>

        <div class="bottom-grid">
            <!-- Last 14 Days (Bar Chart) -->
            <div class="chart-card">
                <div class="card-header">
                    <div class="title-group">
                        <h3>Daily Activity</h3>
                        <p class="subtitle">Last 14 days performance</p>
                    </div>
                    <div class="chart-legend">
                        <span class="dot actual-dot"></span> Actual
                        <span class="dot target-dot"></span> Target
                    </div>
                </div>
                <app-daily-stats-chart [data]="activityData" mode="bar"></app-daily-stats-chart>
            </div>

            <!-- Contribution Heatmap -->
            <div class="chart-card heatmap-card">
                <div class="card-header">
                    <div class="title-group">
                        <h3>Monthly Frequency</h3>
                        <p class="subtitle">Your daily consistency this month</p>
                    </div>
                </div>
                <div class="heatmap-container">
                    <div class="heatmap-weekdays">
                        <span class="weekday-label">Sun</span>
                        <span class="weekday-label">Mon</span>
                        <span class="weekday-label">Tue</span>
                        <span class="weekday-label">Wed</span>
                        <span class="weekday-label">Thu</span>
                        <span class="weekday-label">Fri</span>
                        <span class="weekday-label">Sat</span>
                    </div>
                    <div class="heatmap-grid monthly-grid">
                        <div class="week-row" *ngFor="let week of heatmapGrid">
                            <div class="day-cell" *ngFor="let day of week" [attr.data-level]="day.level"
                                [class.empty-day]="isDayOutsideCurrentMonth(day.date)"
                                [class.is-today]="isToday(day.date)"
                                [title]="getFormattedDate(day.date) + ': ' + day.count + ' words'"
                                (mouseenter)="showHeatmapTooltip($event, day)" (mouseleave)="hideHeatmapTooltip()">
                                <span class="day-number" *ngIf="!isDayOutsideCurrentMonth(day.date)">{{
                                    day.date.getDate() }}</span>
                                <span class="day-count" *ngIf="day.count > 0 && !isDayOutsideCurrentMonth(day.date)">{{
                                    day.count | number:'1.0-1' }}</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="legend">
                    <span class="legend-label">Activity: Low</span>
                    <div class="levels">
                        <div class="day-cell" data-level="0"></div>
                        <div class="day-cell" data-level="1"></div>
                        <div class="day-cell" data-level="2"></div>
                        <div class="day-cell" data-level="3"></div>
                        <div class="day-cell" data-level="4"></div>
                    </div>
                    <span class="legend-label">High</span>
                </div>
                <!-- Tooltip -->
                <div class="heatmap-tooltip" *ngIf="heatmapTooltip.visible" [style.left.px]="heatmapTooltip.x"
                    [style.top.px]="heatmapTooltip.y">
                    <div class="tooltip-date">{{ heatmapTooltip.date }}</div>
                    <div class="tooltip-count">{{ heatmapTooltip.count | number }} words</div>
                </div>
            </div>
        </div>
    </div>
</div>