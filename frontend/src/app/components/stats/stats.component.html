<div class="stats-container">
    <app-content-loader *ngIf="isLoading"></app-content-loader>

    <div class="content" *ngIf="!isLoading">
        <div class="header">
            <h1><i class="fas fa-chart-pie"></i> Writing Insights</h1>
            <p>Visualize your habits and progress over time.</p>
        </div>

        <!-- Key Metrics Cards - EXACT Create Plan Design -->
        <div class="metrics-grid">
            <div class="metric-card">
                <div class="stat-value">{{ currentStreak }}</div>
                <div class="stat-label">Current Streak (days) <i class="fas fa-star"></i></div>
            </div>
            <div class="metric-card">
                <div class="stat-value">{{ bestDay | number }}</div>
                <div class="stat-label">Best Day (words) <i class="fas fa-star"></i></div>
            </div>
            <div class="metric-card">
                <div class="stat-value">{{ totalWords | number }}</div>
                <div class="stat-label">Total Written (words) <i class="fas fa-star"></i></div>
            </div>
            <div class="metric-card">
                <div class="stat-value">{{ weeklyAvg | number }}</div>
                <div class="stat-label">Weekly Avg (words) <i class="fas fa-star"></i></div>
            </div>
        </div>

        <!-- Cumulative Progress (Line Chart) -->
        <div class="chart-card line-chart-card">
            <div class="card-header">
                <h3>Cumulative Growth</h3>
                <div class="chart-legend">
                    <span class="dot"></span> Cumulative Word Count
                </div>
            </div>
            <app-output-stats-chart [data]="allDaysDataForChart"
                [initialCount]="initialChartCount"></app-output-stats-chart>
        </div>

        <div class="bottom-grid">
            <!-- Last 14 Days (Bar Chart) -->
            <div class="chart-card">
                <div class="card-header">
                    <h3>Daily Activity</h3>
                    <div class="chart-legend">
                        <span class="dot"></span> Words per day
                    </div>
                </div>
                <app-daily-stats-chart [data]="activityData"></app-daily-stats-chart>
            </div>

            <!-- Contribution Heatmap -->
            <div class="chart-card heatmap-card">
                <div class="card-header">
                    <h3>Monthly Frequency</h3>
                </div>
                <div class="heatmap-grid">
                    <div class="week-col" *ngFor="let week of heatmapGrid">
                        <div class="day-cell" *ngFor="let day of week" [attr.data-level]="day.level"
                            [title]="(day.date | date) + ': ' + day.count + ' words'">
                        </div>
                    </div>
                </div>
                <div class="legend">
                    <span>Less</span>
                    <div class="levels">
                        <div class="day-cell" data-level="0"></div>
                        <div class="day-cell" data-level="1"></div>
                        <div class="day-cell" data-level="2"></div>
                        <div class="day-cell" data-level="3"></div>
                        <div class="day-cell" data-level="4"></div>
                    </div>
                    <span>More</span>
                </div>
            </div>
        </div>
    </div>
</div>