<div class="challenges-container">
    <!-- Top Nav Tabs -->
    <nav class="main-tabs">
        <a routerLink="/calendar" routerLinkActive="active" class="tab-link"><i class="fas fa-calendar-alt"></i>
            Calendar</a>
        <a routerLink="/plans" routerLinkActive="active" class="tab-link"><i class="fas fa-tasks"></i> Plans</a>
        <a routerLink="/organize" routerLinkActive="active" class="tab-link"><i class="fas fa-folder"></i> Projects</a>
        <a routerLink="/stats" routerLinkActive="active" class="tab-link"><i class="fas fa-chart-bar"></i> Stats</a>
        <a routerLink="/challenges" routerLinkActive="active" class="tab-link active"><i class="fas fa-users"></i>
            Challenges</a>
        <a routerLink="/plans" [queryParams]="{filter: 'archived'}" routerLinkActive="active" class="tab-link"><i
                class="fas fa-archive"></i> Archives</a>
    </nav>
    <div class="split-line"></div>

    <!-- Hero Section -->
    <div class="hero-section">
        <div class="hero-icon">
            <i class="fas fa-trophy"></i>
        </div>
        <h1 class="main-heading">Group Writing Challenges</h1>
        <p class="subheading">Join forces with fellow writers. Compete, encourage, and achieve your goals together.</p>

        <div class="action-buttons">
            <button class="btn btn-learn" (click)="openGuideModal()">
                <i class="fas fa-info-circle"></i>
                Learn About Challenges
            </button>
            <button class="btn btn-create" (click)="openModal()">
                <i class="fas fa-plus-circle"></i>
                Create a Challenge
            </button>
        </div>
    </div>

    <!-- Features Section -->
    <div class="features-section" id="challenge-features">
        <div class="feature-card">
            <div class="feature-icon">ðŸ“Š</div>
            <h3>Track Progress</h3>
            <p>Monitor your performance and compare with other participants in real-time</p>
        </div>
        <div class="feature-card">
            <div class="feature-icon">ðŸŽ¯</div>
            <h3>Set Goals</h3>
            <p>Define word count, time-based, or custom goals to challenge yourself and others</p>
        </div>
    </div>

    <!-- Join by Invite Code -->
    <div class="invite-code-section fade-in">
        <div class="invite-card">
            <div class="invite-icon"><i class="fas fa-key"></i></div>
            <div class="invite-content">
                <h3>Have an Invite Code?</h3>
                <p>Join a private challenge instantly.</p>
                <div class="invite-form">
                    <input type="text" [(ngModel)]="inviteCodeInput" placeholder="Enter 6-digit code" maxlength="6"
                        [disabled]="isSubmitting" (keyup.enter)="joinByCode()"
                        (input)="inviteCodeInput = inviteCodeInput.toUpperCase()" class="invite-code-input">
                    <button class="btn-primary" (click)="joinByCode()"
                        [disabled]="!inviteCodeInput.trim() || isSubmitting">
                        <span *ngIf="!isSubmitting">Join</span>
                        <span *ngIf="isSubmitting">
                            <i class="fas fa-spinner fa-spin"></i> Joining...
                        </span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Active Challenges Section -->
    <app-content-loader *ngIf="loading"></app-content-loader>

    <div class="challenges-list" *ngIf="!loading && activeChallenges.length > 0">
        <h2 class="section-title">Active Challenges</h2>
        <div class="challenge-grid">
            <div class="challenge-card" *ngFor="let challenge of activeChallenges">
                <div class="challenge-header">
                    <h3>{{ challenge.name }}</h3>
                    <span class="challenge-badge">{{ challenge.participants }} participants</span>
                </div>
                <p class="challenge-description">{{ challenge.description }}</p>
                <div class="challenge-stats">
                    <div class="stat">
                        <span class="stat-label">Goal</span>
                        <span class="stat-value">{{ challenge.goal_amount | number }} words</span>
                    </div>
                    <div class="stat">
                        <span class="stat-label">Ends</span>
                        <span class="stat-value" *ngIf="challenge.end_date">{{ challenge.end_date | date:'MMM d'
                            }}</span>
                    </div>
                </div>

                <div class="card-actions">
                    <button *ngIf="challenge.is_joined == 1" class="btn-dashboard"
                        [routerLink]="['/challenge', challenge.id]">
                        Dashboard
                    </button>
                    <button *ngIf="challenge.is_joined != 1" class="btn-join" (click)="joinChallenge(challenge.id)">
                        Join Challenge
                    </button>
                </div>
            </div>
        </div>

        <div class="pagination-controls" *ngIf="totalPages > 1">
            <div class="page-size">
                <label>Show:</label>
                <select (change)="onPageSizeChange($event)">
                    <option [value]="10" [selected]="itemsPerPage === 10">10</option>
                    <option [value]="20" [selected]="itemsPerPage === 20">20</option>
                    <option [value]="50" [selected]="itemsPerPage === 50">50</option>
                </select>
            </div>
            <div class="page-nav">
                <button (click)="prevPage()" [disabled]="currentPage === 1">Previous</button>
                <span>Page {{ currentPage }} of {{ totalPages }}</span>
                <button (click)="nextPage()" [disabled]="currentPage === totalPages">Next</button>
            </div>
        </div>
    </div>

    <!-- Empty State -->
    <div class="empty-state" *ngIf="!loading && activeChallenges.length === 0">
        <div class="empty-icon">ðŸŒŸ</div>
        <h3>No Active Challenges Yet</h3>
        <p>Be the first to create a challenge and invite your writing community!</p>
        <button class="btn btn-create-large" (click)="openModal()">
            <i class="fas fa-plus"></i>
            Create Your First Challenge
        </button>
    </div>

    <!-- Modal -->
    <div class="modal-overlay" *ngIf="showModal" (click)="closeModal()">
        <div class="modal-dialog" (click)="$event.stopPropagation()">
            <div class="modal-header">
                <h2>Create New Challenge</h2>
                <button class="close-btn" (click)="closeModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Challenge Name *</label>
                    <input type="text" [(ngModel)]="newChallenge.name" placeholder="e.g. NaNoWriMo 2026"
                        [class.is-invalid]="formErrors.title || formErrors.name">
                    <div class="error-text" *ngIf="formErrors.title || formErrors.name">{{ formErrors.title ||
                        formErrors.name }}</div>
                </div>

                <div class="form-group">
                    <label>Description *</label>
                    <textarea [(ngModel)]="newChallenge.description" rows="3" placeholder="What's this challenge about?"
                        [class.is-invalid]="formErrors.description"></textarea>
                    <div class="error-text" *ngIf="formErrors.description">{{ formErrors.description }}</div>
                </div>

                <div class="form-row">
                    <div class="form-group half">
                        <label>Start Date *</label>
                        <input type="date" [(ngModel)]="newChallenge.start_date"
                            [class.is-invalid]="formErrors.start_date" [min]="todayStr">
                        <div class="error-text" *ngIf="formErrors.start_date">{{ formErrors.start_date }}</div>
                    </div>
                    <div class="form-group half">
                        <label>End Date *</label>
                        <input type="date" [(ngModel)]="newChallenge.end_date" [class.is-invalid]="formErrors.end_date"
                            [min]="newChallenge.start_date || todayStr">
                        <div class="error-text" *ngIf="formErrors.end_date">{{ formErrors.end_date }}</div>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group half">
                        <label>Goal Type</label>
                        <select [(ngModel)]="newChallenge.goal_type" [class.is-invalid]="formErrors.goal_type">
                            <option value="word_count">Word Count</option>
                            <option value="time_based">Time Based (minutes)</option>
                            <option value="task_based">Task Based (number of tasks)</option>
                        </select>
                        <div class="error-text" *ngIf="formErrors.goal_type">{{ formErrors.goal_type }}</div>
                    </div>
                    <div class="form-group half">
                        <label>Goal Amount</label>
                        <input type="number" [(ngModel)]="newChallenge.goal_amount"
                            [class.is-invalid]="formErrors.goal_amount">
                        <div class="error-text" *ngIf="formErrors.goal_amount">{{ formErrors.goal_amount }}</div>
                    </div>
                </div>

                <div class="form-group checkbox-group">
                    <label class="custom-checkbox">
                        <input type="checkbox" [(ngModel)]="newChallenge.is_public">
                        <span class="checkmark-box"></span>
                        <span class="label-text">Public Challenge (Anyone can join)</span>
                    </label>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-cancel" (click)="closeModal()">Cancel</button>
                <button class="btn-primary" (click)="createChallenge()" [disabled]="isSubmitting">
                    {{ isSubmitting ? 'Creating...' : 'Create Challenge' }}
                </button>
            </div>
        </div>
    </div>

    <!-- Guide Modal -->
    <div class="modal-overlay guide-modal-overlay" *ngIf="showGuideModal" (click)="closeGuideModal()">
        <div class="modal-dialog guide-modal" (click)="$event.stopPropagation()">
            <div class="modal-header">
                <div class="header-icon">
                    <i class="fas fa-lightbulb"></i>
                </div>
                <h2>Understanding Challenges</h2>
                <button class="close-btn" (click)="closeGuideModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="guide-intro">
                    <p>Challenges are timed writing events where authors work toward specific goals together. It's the
                        ultimate way to boost your productivity!</p>
                </div>
                <div class="guide-steps">
                    <div class="guide-step">
                        <div class="step-num">1</div>
                        <div class="step-content">
                            <h4>Find or Create</h4>
                            <p>Browse public challenges or create a private one for your writing group with a unique
                                invite code.</p>
                        </div>
                    </div>
                    <div class="guide-step">
                        <div class="step-num">2</div>
                        <div class="step-content">
                            <h4>Set Your Target</h4>
                            <p>Choose between total word counts, daily averages, or time-based goals. Define your start
                                and end dates.</p>
                        </div>
                    </div>
                    <div class="guide-step">
                        <div class="step-num">3</div>
                        <div class="step-content">
                            <h4>Compete & Track</h4>
                            <p>Log your progress daily. Watch your position on the leaderboard and cheer on your fellow
                                writers.</p>
                        </div>
                    </div>
                </div>
                <div class="guide-pro-tip">
                    <i class="fas fa-star"></i>
                    <span><strong>Pro Tip:</strong> Private challenges are perfect for accountability partners!</span>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-primary" (click)="closeGuideModal()">Got it, thanks!</button>
            </div>
        </div>
    </div>
</div>