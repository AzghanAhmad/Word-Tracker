<div class="create-plan-redesign">
    <!-- Header -->
    <header class="plan-header">
        <div class="title-section">
            <h1 *ngIf="!planName">Edit me: A Brand New Goal!</h1>
            <h1 *ngIf="planName">{{ planName }}</h1>
            <p class="subtitle">{{ contentType }} {{ activityType }}</p>
        </div>
        <div class="header-actions">
            <button class="btn-done" (click)="savePlan()" [disabled]="isLoading">
                <i class="fas fa-check"></i> Done Editing
            </button>
            <button class="btn-save" (click)="savePlan()" [disabled]="isLoading">
                <i class="fas" [ngClass]="isLoading ? 'fa-spinner fa-spin' : 'fa-save'"></i> {{ isLoading ? 'Saving...'
                : 'Save' }}
            </button>

        </div>
    </header>

    <!-- Tabs Navigation -->
    <nav class="plan-tabs">
        <button type="button" [class.active]="viewMode === 'schedule'"
            (click)="setViewMode('schedule')">Schedule</button>
        <button type="button" [class.active]="viewMode === 'progress'"
            (click)="setViewMode('progress')">Progress</button>
        <button type="button" [class.active]="viewMode === 'stats'" (click)="setViewMode('stats')">Stats</button>
    </nav>

    <div class="plan-content">
        <!-- Sidebar -->
        <aside class="plan-sidebar" *ngIf="viewMode !== 'plan'">
            <div class="sidebar-card sidebar-high-fidelity">
                <div class="card-header">
                    <h3>Plan Info</h3>
                    <i class="fas fa-arrows-alt-v"></i>
                </div>
                <div class="card-body">
                    <div class="form-group">
                        <label>Name <span class="text-danger">*</span></label>
                        <input type="text" placeholder="e.g. November Nanowrimo Novel" [(ngModel)]="planName">
                    </div>
                    <div class="form-row">
                        <div class="form-group half">
                            <label>Activity :</label>
                            <select [(ngModel)]="activityType">
                                <option value="Recording">Recording</option>
                                <option value="Narrating">Narrating</option>
                                <option value="Drafting">Drafting</option>
                                <option value="Editing">Editing</option>
                                <option value="Grading">Grading</option>
                                <option value="Plotting">Plotting</option>
                                <option value="Proofreading">Proofreading</option>
                                <option value="Publishing">Publishing</option>
                                <option value="Reading">Reading</option>
                                <option value="Revision">Revision</option>
                                <option value="Release">Release</option>
                                <option value="Study">Study</option>
                                <option value="Setup">Setup</option>
                                <option value="Transcription">Transcription</option>
                                <option value="Translation">Translation</option>
                                <option value="Work">Work</option>
                                <option value="Writing">Writing</option>
                                <option value="Saving">Saving</option>
                                <option value="Spending">Spending</option>
                                <option value="Running">Running</option>
                                <option value="Training">Training</option>
                                <option value="Losing">Losing</option>
                                <option value="Winning">Winning</option>
                                <option value="Marketing">Marketing</option>
                                <option value="Crafting">Crafting</option>
                                <option value="Watching">Watching</option>
                                <option value="Admin">Admin</option>
                            </select>
                        </div>
                        <div class="form-group half">
                            <label>Content type :</label>
                            <select [(ngModel)]="contentType">
                                <option value="Audiobook">Audiobook</option>
                                <option value="Book">Book</option>
                                <option value="Blog Post">Blog Post</option>
                                <option value="Chapbook">Chapbook</option>
                                <option value="Comics">Comics</option>
                                <option value="Conference Paper">Conference Paper</option>
                                <option value="Diary">Diary</option>
                                <option value="Dissertation">Dissertation</option>
                                <option value="Documentation">Documentation</option>
                                <option value="Essay">Essay</option>
                                <option value="Fiction">Fiction</option>
                                <option value="Grant">Grant</option>
                                <option value="Journal">Journal</option>
                                <option value="Journal Paper">Journal Paper</option>
                                <option value="Magazine Article">Magazine Article</option>
                                <option value="Manuals">Manuals</option>
                                <option value="Manuscript">Manuscript</option>
                                <option value="Newsletter">Newsletter</option>
                                <option value="Newspaper Article">Newspaper Article</option>
                                <option value="Non-Fiction">Non-Fiction</option>
                                <option value="Novel">Novel</option>
                                <option value="Novella">Novella</option>
                                <option value="Paper">Paper</option>
                                <option value="Poem">Poem</option>
                                <option value="Practice">Practice</option>
                                <option value="Project">Project</option>
                                <option value="Proposal">Proposal</option>
                                <option value="Screenplay">Screenplay</option>
                                <option value="Script">Script</option>
                                <option value="Short Story">Short Story</option>
                                <option value="Speech">Speech</option>
                                <option value="Technical Document">Technical Document</option>
                                <option value="Textbook">Textbook</option>
                                <option value="Thesis">Thesis</option>
                                <option value="Money">Money</option>
                                <option value="Workout">Workout</option>
                                <option value="Work">Work</option>
                                <option value="Marathon">Marathon</option>
                                <option value="Weight">Weight</option>
                                <option value="Other">Other</option>
                                <option value="Video">Video</option>
                                <option value="TV">TV</option>
                                <option value="Movie">Movie</option>
                                <option value="Game">Game</option>
                                <option value="Website">Website</option>
                                <option value="Home">Home</option>
                                <option value="Personal">Personal</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group half">
                            <label>Start Date :</label>
                            <input type="date" [(ngModel)]="startDate" (change)="onDateChange()">
                        </div>
                        <div class="form-group half">
                            <label>End Date :</label>
                            <input type="date" [(ngModel)]="endDate" (change)="onDateChange()">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Plan Description -->
            <div class="sidebar-card description-card sidebar-high-fidelity">
                <div class="card-header">
                    <h3>Plan Description <span class="text-danger">*</span></h3>
                    <i class="fas fa-pen-fancy"></i>
                </div>
                <div class="card-body">
                    <!-- Privacy Option -->
                    <div class="privacy-section mb-3">
                        <div class="checkbox-item">
                            <label class="i-checks d-flex align-items-center">
                                <input type="checkbox" [(ngModel)]="isPrivate">
                                <i class="checkbox-box"></i>
                                <span class="ml-2">
                                    <i class="fas fa-lock text-muted mr-1" title="Make this plan private"></i>
                                    Make this plan private
                                </span>
                            </label>
                        </div>
                    </div>

                    <!-- Word Count Label -->
                    <div class="description-header mb-2">
                        <label class="d-flex align-items-center gap-1" style="font-size: 0.85rem; color: #475569;">
                            <span [class.text-danger]="isDescriptionOverLimit()">
                                <strong>{{ getDescriptionWordCount() }} {{ getDescriptionWordCount() === 1 ? 'word' :
                                    'words' }}</strong>
                            </span>
                            <span class="text-slate-400">/</span>
                            <span>Max 300 words</span>
                        </label>
                    </div>

                    <div class="quill-editor-wrapper" [class.over-limit]="isDescriptionOverLimit()">
                        <quill-editor [(ngModel)]="planDescription" [modules]="quillModules"
                            (onContentChanged)="onContentChanged($event)"
                            placeholder="Enter a description for your plan..." theme="snow">
                        </quill-editor>
                    </div>

                    <!-- Premium Offer (Hidden by default) -->
                    <div class="premium-prompt mt-3" style="display: none; font-size: 0.85rem; color: #64748b;">
                        Sign up for <a href="/premium" style="color: #1C2E4A; font-weight: 500;">Pacemaker Premium</a>
                        to use these settings.
                    </div>
                </div>
            </div>

            <!-- Goals Section -->
            <div class="sidebar-card goals-card sidebar-high-fidelity">
                <div class="card-header">
                    <h3>Goals</h3>
                    <i class="fas fa-arrows-alt-v"></i>
                </div>
                <div class="card-body">
                    <div class="form-row">
                        <div class="form-group half">
                            <label>STARTING POINT <i class="fas fa-info-circle text-muted ml-1"
                                    style="font-size: 0.8rem;"></i></label>
                            <input type="number" [(ngModel)]="startingPoint" class="white-bg-input">
                        </div>
                        <div class="form-group half">
                            <label>TARGET</label>
                            <input type="number" [(ngModel)]="targetWordCount" class="white-bg-input">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>HOW IT'S MEASURED</label>
                        <select [(ngModel)]="measurementUnit" class="white-bg-input"
                            style="width: 100%; padding: 8px; border: 1px solid #e5e7eb; border-radius: 4px;">
                            <option value="feature">Features</option>
                            <option value="word">Words</option>
                            <option value="paragraph">Paragraphs</option>
                            <option value="page">Pages</option>
                            <option value="poem">Poems</option>
                            <option value="chapter">Chapters</option>
                            <option value="section">Sections</option>
                            <option value="character">Characters</option>
                            <option value="verse">Verses</option>
                            <option value="act">Acts</option>
                            <option value="scene">Scenes</option>
                            <option value="stanza">Stanzas</option>
                            <option value="line">Lines</option>
                            <option value="book">Books</option>
                            <option value="day">Days</option>
                            <option value="hour">Hours</option>
                            <option value="minute">Minutes</option>
                            <option value="unit">Units</option>
                            <option value="item">Items</option>
                            <option value="task">Tasks</option>
                            <option value="todo">Todos</option>
                            <option value="step">Steps</option>
                            <option value="entry">Entries</option>
                            <option value="post">Posts</option>
                            <option value="worksheet">Worksheets</option>
                            <option value="dollar">Dollars</option>
                            <option value="mile">Miles</option>
                            <option value="km">Kilometers</option>
                            <option value="lb">Pounds (lb)</option>
                            <option value="kg">Kilograms (kg)</option>
                            <option value="stitch">Stitches</option>
                            <option value="time">Times</option>
                            <option value="episode">Episodes</option>
                            <option value="video">Videos</option>
                            <option value="movie">Movies</option>
                            <option value="lesson">Lessons</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label style="line-height: 1.4; margin-bottom: 0.5rem; display: block;">
                            IS THIS AN OVERALL GOAL OR A DAILY TARGET :
                            <i class="fas fa-info-circle text-muted ml-1"></i>
                        </label>
                        <div class="toggle-container">
                            <div class="toggle-option" [class.active]="!isDailyTarget" (click)="isDailyTarget = false">
                                OVERALL TARGET
                            </div>
                            <div class="toggle-option" [class.active]="isDailyTarget" (click)="isDailyTarget = true">
                                DAILY
                            </div>
                        </div>
                    </div>

                    <div class="date-display-green">
                        Your Start Date: {{ startDate | date:'MM/dd/yyyy' }}
                    </div>

                    <div class="form-group mt-3">
                        <label>FIXED DEADLINE?</label>
                        <div class="toggle-container">
                            <div class="toggle-option" [class.active]="fixedDeadline"
                                (click)="fixedDeadline = true; onFixedDeadlineChange()">
                                YES
                            </div>
                            <div class="toggle-option" [class.active]="!fixedDeadline"
                                (click)="fixedDeadline = false; onFixedDeadlineChange()">
                                NO
                            </div>
                        </div>
                    </div>

                    <div class="form-group" *ngIf="fixedDeadline">
                        <label>TARGET FINISH DATE</label>
                        <input type="date" [(ngModel)]="targetFinishDate" (change)="onTargetFinishDateChange()"
                            class="white-bg-input">
                    </div>
                </div>
            </div>

            <!-- Customizations Card in Sidebar (High-Fidelity) -->
            <div class="sidebar-card customizations-card sidebar-high-fidelity">
                <div class="card-header">
                    <h3>Customizations</h3>
                    <i class="fas fa-arrows-alt-v"></i>
                </div>
                <div class="card-body">
                    <!-- On Weekends? -->
                    <div class="form-group">
                        <label>On Weekends?</label>
                        <div class="segmented-control">
                            <button type="button" [class.active]="weekendApproach === 'Skip'"
                                (click)="setWeekendApproach('Skip')">Skip</button>
                            <button type="button" [class.active]="weekendApproach === 'Do Less'"
                                (click)="setWeekendApproach('Do Less')">Do Less</button>
                            <button type="button" [class.active]="weekendApproach === 'The Usual'"
                                (click)="setWeekendApproach('The Usual')">The Usual</button>
                            <button type="button" [class.active]="weekendApproach === 'Do More'"
                                (click)="setWeekendApproach('Do More')">Do More</button>
                            <button type="button" [class.active]="weekendApproach === 'Push!'"
                                (click)="setWeekendApproach('Push!')">Push!</button>
                        </div>
                    </div>

                    <!-- Customize Workload -->
                    <div class="form-group">
                        <label>Customize Workload on a certain :</label>
                        <div class="action-buttons-group">
                            <button type="button" class="btn-outline-action" (click)="addWeekdayOverride()">
                                <i class="fas fa-plus"></i> weekday?
                            </button>
                            <button type="button" class="btn-outline-action" (click)="addSpecificDateOverride()">
                                <i class="fas fa-plus"></i> date?
                            </button>
                            <button type="button" class="btn-outline-action" (click)="addDateRangeOverride()">
                                <i class="fas fa-plus"></i> date range?
                            </button>
                        </div>

                        <!-- Inline Dynamic Override Form -->
                        <div class="inline-override-form mt-3" *ngIf="showOverrideForm">
                            <div class="form-header-row">
                                <span class="form-title" [ngSwitch]="showOverrideForm">
                                    <span *ngSwitchCase="'weekday'">Select Weekday</span>
                                    <span *ngSwitchCase="'date'">Select Date</span>
                                    <span *ngSwitchCase="'range'">Select Range</span>
                                </span>
                                <button type="button" class="btn-close-inline" (click)="cancelOverride()">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>

                            <div class="form-inputs">
                                <!-- Weekday Selector -->
                                <select *ngIf="showOverrideForm === 'weekday'" [(ngModel)]="newOverride.day"
                                    class="inline-select">
                                    <option [value]="1">Monday</option>
                                    <option [value]="2">Tuesday</option>
                                    <option [value]="3">Wednesday</option>
                                    <option [value]="4">Thursday</option>
                                    <option [value]="5">Friday</option>
                                    <option [value]="6">Saturday</option>
                                    <option [value]="0">Sunday</option>
                                </select>

                                <!-- Date Picker -->
                                <input *ngIf="showOverrideForm === 'date'" type="date" [(ngModel)]="newOverride.date"
                                    class="inline-input-date">

                                <!-- Range Picker -->
                                <div *ngIf="showOverrideForm === 'range'" class="range-picker-inline">
                                    <div class="range-field">
                                        <span class="range-label">From</span>
                                        <input type="date" [(ngModel)]="newOverride.start"
                                            class="inline-input-date mini">
                                    </div>
                                    <div class="range-field">
                                        <span class="range-label">to</span>
                                        <input type="date" [(ngModel)]="newOverride.end" class="inline-input-date mini">
                                    </div>
                                </div>
                            </div>

                            <!-- Intensity Selector -->
                            <div class="segmented-control mini mt-2">
                                <button type="button" [class.active]="newOverride.approach === 'Skip'"
                                    (click)="newOverride.approach = 'Skip'">Skip</button>
                                <button type="button" [class.active]="newOverride.approach === 'Do Less'"
                                    (click)="newOverride.approach = 'Do Less'">Do Less</button>
                                <button type="button" [class.active]="newOverride.approach === 'The Usual'"
                                    (click)="newOverride.approach = 'The Usual'">The Usual</button>
                                <button type="button" [class.active]="newOverride.approach === 'Do More'"
                                    (click)="newOverride.approach = 'Do More'">Do More</button>
                                <button type="button" [class.active]="newOverride.approach === 'Push!'"
                                    (click)="newOverride.approach = 'Push!'">Push!</button>
                            </div>

                            <button type="button" class="btn-add-override mt-2" (click)="saveOverride()">
                                Add Override
                            </button>
                        </div>
                    </div>

                    <!-- Availability Events -->
                    <div class="form-group">
                        <label>Your Availability Events:</label>
                        <div class="availability-status" *ngIf="availabilityEvents.length === 0">
                            No availability events found for this plan period.
                        </div>
                        <div class="events-list" *ngIf="availabilityEvents.length > 0">
                            <!-- Future list of events -->
                        </div>
                    </div>

                    <!-- Reserve Days -->
                    <div class="form-group reserve-sidebar-group">
                        <div class="reserve-input-inline">
                            <label>Reserve</label>
                            <div class="number-input-modern">
                                <input type="number" [(ngModel)]="reserveDays" (ngModelChange)="generatePlanData()"
                                    min="0" max="30">
                            </div>
                            <span class="reserve-suffix">free days at the end, just in case</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Progress Section (NEW) -->
            <div class="sidebar-card progress-card sidebar-high-fidelity">
                <div class="card-header">
                    <h3>Progress</h3>
                    <i class="fas fa-arrows-alt-v"></i>
                </div>
                <div class="card-body">
                    <div class="progress-behavior-group">
                        <div class="behavior-section">
                            <h4 class="behavior-title">How does your plan change with your progress?</h4>

                            <label class="premium-radio-container">
                                <input type="radio" name="planAdjustment" value="adjust" [(ngModel)]="planAdjustment">
                                <span class="checkmark"></span>
                                <span class="radio-label">
                                    <strong>I want my plan to adjust based on my progress</strong> : so I can keep the
                                    same relative pace
                                </span>
                            </label>

                            <label class="premium-radio-container">
                                <input type="radio" name="planAdjustment" value="fixed" [(ngModel)]="planAdjustment">
                                <span class="checkmark"></span>
                                <span class="radio-label">
                                    <strong>I want my plan to stay the same as I work</strong> : I want to see how far
                                    I'm ahead or behind my original plan
                                </span>
                            </label>
                        </div>

                        <div class="behavior-section mt-4">
                            <h4 class="behavior-title">How will you record your progress?</h4>

                            <label class="premium-radio-container">
                                <input type="radio" name="recordingType" value="overall" [(ngModel)]="recordingType">
                                <span class="checkmark"></span>
                                <span class="radio-label">
                                    <strong>Overall Completed Work</strong> : Each day, I'll record how far I've reached
                                    i.e. my cumulative progress.
                                </span>
                            </label>

                            <label class="premium-radio-container">
                                <input type="radio" name="recordingType" value="daily" [(ngModel)]="recordingType">
                                <span class="checkmark"></span>
                                <span class="radio-label">
                                    <strong>Daily Completed Work</strong> : Each day, I'll record what I did on that
                                    day.
                                </span>
                            </label>
                        </div>

                        <div class="behavior-section mt-4">
                            <h4 class="behavior-title">Set Plan Progress</h4>
                            <div class="form-group">
                                <label>Current Progress (%)</label>
                                <div class="progress-input-wrapper">
                                    <input type="number" [ngModel]="currentProgress"
                                        (ngModelChange)="onManualProgressChange($event)"
                                        (blur)="onManualProgressChange(progressInput.value)" min="0" max="100"
                                        step="0.01" class="progress-percentage-input" placeholder="0" #progressInput>
                                    <span class="percentage-symbol">%</span>
                                </div>
                                <p class="hint mt-2" style="font-size: 0.8rem; color: #64748b;">
                                    Enter a percentage (0-100) to automatically distribute actual work done across the
                                    plan from the start date according to this progress level.
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>


            <!-- Strategy (NEW PREMIUM) -->
            <div class="sidebar-card strategy-card sidebar-high-fidelity">
                <div class="card-header">
                    <h3>Strategy</h3>
                    <i class="fas fa-chess-knight"></i>
                </div>
                <div class="card-body">
                    <div class="strategy-selector-section sidebar-version no-border no-margin pt-0">
                        <label class="mb-3 d-block"
                            style="font-weight: 700; color: #4b5563; font-size: 0.85rem; text-transform: uppercase; letter-spacing: 0.05em;">How
                            would you like to approach this?</label>
                        <div class="strategy-options progress-behavior-group">
                            <div class="behavior-section" style="gap: 0.85rem;">
                                <label class="premium-radio-container">
                                    <input type="radio" value="Steady" [(ngModel)]="strategyType"
                                        (change)="onStrategyChange()">
                                    <span class="checkmark"></span>
                                    <span class="radio-label"><strong>Steadily</strong> : same amount every day</span>
                                </label>
                                <label class="premium-radio-container">
                                    <input type="radio" value="Back-load" [(ngModel)]="strategyType"
                                        (change)="onStrategyChange()">
                                    <span class="checkmark"></span>
                                    <span class="radio-label"><strong>Rising to the challenge</strong> : finish
                                        strong</span>
                                </label>
                                <label class="premium-radio-container">
                                    <input type="radio" value="Front-load" [(ngModel)]="strategyType"
                                        (change)="onStrategyChange()">
                                    <span class="checkmark"></span>
                                    <span class="radio-label"><strong>Biting the bullet</strong> : start strong</span>
                                </label>
                                <label class="premium-radio-container">
                                    <input type="radio" value="Mountain" [(ngModel)]="strategyType"
                                        (change)="onStrategyChange()">
                                    <span class="checkmark"></span>
                                    <span class="radio-label"><strong>Mountain Hike</strong> : effort in the
                                        middle</span>
                                </label>
                                <label class="premium-radio-container">
                                    <input type="radio" value="Valley" [(ngModel)]="strategyType"
                                        (change)="onStrategyChange()">
                                    <span class="checkmark"></span>
                                    <span class="radio-label"><strong>Valley</strong> : effort at start and end</span>
                                </label>
                                <label class="premium-radio-container">
                                    <input type="radio" value="Oscillating" [(ngModel)]="strategyType"
                                        (change)="onStrategyChange()">
                                    <span class="checkmark"></span>
                                    <span class="radio-label"><strong>Oscillating</strong> : mixed loads</span>
                                </label>
                                <label class="premium-radio-container">
                                    <input type="radio" value="Randomly" [(ngModel)]="strategyType"
                                        (change)="onStrategyChange()">
                                    <span class="checkmark"></span>
                                    <span class="radio-label">
                                        <strong>Randomly</strong> : surprise
                                        <button class="btn-more-random" (click)="onStrategyChange()"
                                            style="padding: 2px 6px; font-size: 0.7rem;">Surprise Me</button>
                                    </span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <div class="intensity-selector-section mt-4 pt-3" style="border-top: 1px solid #f1f5f9;">
                        <label class="mb-2 d-block"
                            style="font-weight: 700; color: #4b5563; font-size: 0.85rem; text-transform: uppercase; letter-spacing: 0.05em;">Intensity?
                            <span class="beta-tag">(Beta)</span></label>
                        <div class="intensity-group-container">
                            <div class="intensity-button-group" style="width: 100%;">
                                <button type="button" style="padding: 8px 4px; font-size: 0.75rem; flex: 1;"
                                    [class.active]="strategyIntensity === 'Gentle'"
                                    (click)="strategyIntensity = 'Gentle'; onStrategyChange()">Gentle</button>
                                <button type="button" style="padding: 8px 4px; font-size: 0.75rem; flex: 1;"
                                    [class.active]="strategyIntensity === 'Low'"
                                    (click)="strategyIntensity = 'Low'; onStrategyChange()">Low</button>
                                <button type="button" style="padding: 8px 4px; font-size: 0.75rem; flex: 1;"
                                    [class.active]="strategyIntensity === 'Average'"
                                    (click)="strategyIntensity = 'Average'; onStrategyChange()">Avg</button>
                                <button type="button" style="padding: 8px 4px; font-size: 0.75rem; flex: 1;"
                                    [class.active]="strategyIntensity === 'Medium'"
                                    (click)="strategyIntensity = 'Medium'; onStrategyChange()">Med</button>
                                <button type="button" style="padding: 8px 4px; font-size: 0.75rem; flex: 1;"
                                    [class.active]="strategyIntensity === 'Hard Core'"
                                    (click)="strategyIntensity = 'Hard Core'; onStrategyChange()">Hard</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>


            <!-- Display -->
            <div class="sidebar-card display-card sidebar-high-fidelity">
                <div class="card-header">
                    <h3>Display</h3>
                    <i class="fas fa-arrows-alt-v"></i>
                </div>
                <div class="card-body">
                    <div class="form-group mb-4">
                        <label class="mb-2">View as :</label>
                        <div class="view-type-toggle-group">
                            <button type="button" class="view-type-btn" [class.active]="displayViewType === 'Table'"
                                (click)="displayViewType = 'Table'">
                                <i class="fas fa-list-ul"></i>
                                <span>Table</span>
                            </button>
                            <button type="button" class="view-type-btn" [class.active]="displayViewType === 'Graph'"
                                (click)="displayViewType = 'Graph'">
                                <i class="fas fa-chart-area"></i>
                                <span>Graph</span>
                            </button>
                            <button type="button" class="view-type-btn" [class.active]="displayViewType === 'Calendar'"
                                (click)="displayViewType = 'Calendar'">
                                <i class="fas fa-calendar-day"></i>
                                <span>Calendar</span>
                            </button>
                            <button type="button" class="view-type-btn" [class.active]="displayViewType === 'Bar'"
                                (click)="displayViewType = 'Bar'">
                                <i class="fas fa-chart-bar"></i>
                                <span>Bar</span>
                            </button>
                        </div>
                    </div>

                    <div class="form-group mb-4">
                        <label class="mb-2">Weeks begin on :</label>
                        <div class="radio-inline-group">
                            <label class="radio-item">
                                <input type="radio" value="Sundays" [(ngModel)]="weekStartDay" name="weekStartDay">
                                <span class="checkmark"></span>
                                <span class="label-text">Sundays</span>
                            </label>
                            <label class="radio-item">
                                <input type="radio" value="Mondays" [(ngModel)]="weekStartDay" name="weekStartDay">
                                <span class="checkmark"></span>
                                <span class="label-text">Mondays</span>
                            </label>
                        </div>
                    </div>

                    <div class="form-group mb-4">
                        <label class="mb-2">Group schedule and progress by :</label>
                        <div class="radio-inline-group flex-wrap">
                            <label class="radio-item">
                                <input type="radio" value="Day" [(ngModel)]="groupingType" name="groupingType">
                                <span class="checkmark"></span>
                                <span class="label-text">Day</span>
                            </label>
                            <label class="radio-item">
                                <input type="radio" value="Week" [(ngModel)]="groupingType" name="groupingType">
                                <span class="checkmark"></span>
                                <span class="label-text">Week</span>
                            </label>
                            <label class="radio-item">
                                <input type="radio" value="Month" [(ngModel)]="groupingType" name="groupingType">
                                <span class="checkmark"></span>
                                <span class="label-text">Month</span>
                            </label>
                            <label class="radio-item">
                                <input type="radio" value="Year" [(ngModel)]="groupingType" name="groupingType">
                                <span class="checkmark"></span>
                                <span class="label-text">Year</span>
                            </label>
                        </div>
                    </div>

                    <div class="form-group mb-4">
                        <label class="mb-2">Color on Dashboard Calendar :</label>
                        <div class="color-picker-modern" (click)="colorInput.click()">
                            <input type="color" [(ngModel)]="dashboardColor" #colorInput
                                style="position: absolute; opacity: 0; width: 0; height: 0;">
                            <div class="color-preview" [style.background-color]="dashboardColor"></div>
                            <span class="color-hex">{{ dashboardColor }}</span>
                        </div>
                    </div>

                    <hr class="separator-line mb-3">

                    <div class="form-group">
                        <label class="mb-2">Privacy</label>
                        <div class="privacy-toggle-modern" (click)="togglePlanVisibility()">
                            <div class="toggle-switch" [class.active]="isPrivate">
                                <div class="slider"></div>
                            </div>
                            <span class="toggle-label">{{ isPrivate ? 'Private Plan' : 'Public Plan' }}</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Plan Behavior (Moving from Progress) -->
            <div class="sidebar-card">
                <div class="card-header">
                    <h3>Plan Behavior</h3>
                    <i class="fas fa-cog"></i>
                </div>
                <div class="card-body">
                    <div class="form-group">
                        <label>Adaptation</label>
                        <select [(ngModel)]="planAdjustment">
                            <option value="adjust">Auto-Adjust Plan</option>
                            <option value="fixed">Stay Fixed</option>
                        </select>
                        <p class="hint mt-1" style="font-size: 0.8rem; color: #64748b; margin-top: 0.5rem;">
                            {{ planAdjustment === 'adjust' ? 'Future targets change to keep deadline.' : 'Targets stay
                            constant.' }}
                        </p>
                    </div>

                    <div class="form-group">
                        <label>Logging Style</label>
                        <select [(ngModel)]="recordingType">
                            <option value="overall">Cumulative (Total Reach)</option>
                            <option value="daily">Daily Sprints (Session)</option>
                        </select>
                        <p class="hint mt-1" style="font-size: 0.8rem; color: #64748b; margin-top: 0.5rem;">
                            {{ recordingType === 'overall' ? 'Record total progress reached so far.' : 'Record amount
                            completed in each session.' }}
                        </p>
                    </div>
                </div>
            </div>


        </aside>

        <!-- Main Content -->
        <main class="plan-main">
            <!-- Planning Section (NEW REDESIGN) -->
            <div *ngIf="viewMode === 'plan'" class="planning-view">

                <!-- ðŸ“Œ Project Information -->
                <div class="planning-block">
                    <div class="block-header" (click)="sections.projectInfo = !sections.projectInfo">
                        <div class="title-group">
                            <div class="block-icon"><i class="fas fa-info-circle"></i></div>
                            <h2>Project Information</h2>
                        </div>
                        <i class="fas fa-chevron-down toggle-icon" [class.open]="sections.projectInfo"></i>
                    </div>
                    <div class="block-content" *ngIf="sections.projectInfo">
                        <div class="option-row">
                            <div class="option-label-group">
                                <label>Project Title</label>
                                <p class="explanation">Give your project a name that inspires you. This will be the
                                    primary label for your writing goal throughout the app.</p>
                            </div>
                            <div class="option-control">
                                <input type="text" [(ngModel)]="planName" placeholder="e.g. The Great American Novel">
                            </div>
                        </div>

                        <div class="option-row">
                            <div class="option-label-group">
                                <label>Project Type</label>
                                <p class="explanation">What kind of work are you creating? Selecting the right type
                                    helps us provide better context for your progress.</p>
                            </div>
                            <div class="option-control">
                                <select [(ngModel)]="contentType">
                                    <option value="Audiobook">Audiobook</option>
                                    <option value="Book">Book</option>
                                    <option value="Blog Post">Blog Post</option>
                                    <option value="Chapbook">Chapbook</option>
                                    <option value="Comics">Comics</option>
                                    <option value="Conference Paper">Conference Paper</option>
                                    <option value="Diary">Diary</option>
                                    <option value="Dissertation">Dissertation</option>
                                    <option value="Documentation">Documentation</option>
                                    <option value="Essay">Essay</option>
                                    <option value="Fiction">Fiction</option>
                                    <option value="Grant">Grant</option>
                                    <option value="Journal">Journal</option>
                                    <option value="Journal Paper">Journal Paper</option>
                                    <option value="Magazine Article">Magazine Article</option>
                                    <option value="Manuals">Manuals</option>
                                    <option value="Manuscript">Manuscript</option>
                                    <option value="Newsletter">Newsletter</option>
                                    <option value="Newspaper Article">Newspaper Article</option>
                                    <option value="Non-Fiction">Non-Fiction</option>
                                    <option value="Novel">Novel</option>
                                    <option value="Novella">Novella</option>
                                    <option value="Paper">Paper</option>
                                    <option value="Poem">Poem</option>
                                    <option value="Practice">Practice</option>
                                    <option value="Project">Project</option>
                                    <option value="Proposal">Proposal</option>
                                    <option value="Screenplay">Screenplay</option>
                                    <option value="Script">Script</option>
                                    <option value="Short Story">Short Story</option>
                                    <option value="Speech">Speech</option>
                                    <option value="Technical Document">Technical Document</option>
                                    <option value="Textbook">Textbook</option>
                                    <option value="Thesis">Thesis</option>
                                    <option value="Money">Money</option>
                                    <option value="Workout">Workout</option>
                                    <option value="Work">Work</option>
                                    <option value="Marathon">Marathon</option>
                                    <option value="Weight">Weight</option>
                                    <option value="Other">Other</option>
                                    <option value="Video">Video</option>
                                    <option value="TV">TV</option>
                                    <option value="Movie">Movie</option>
                                    <option value="Game">Game</option>
                                    <option value="Website">Website</option>
                                    <option value="Home">Home</option>
                                    <option value="Personal">Personal</option>
                                </select>
                            </div>
                        </div>

                        <div class="option-row">
                            <div class="option-label-group">
                                <label>Project Timeline</label>
                                <p class="explanation">Define when you plan to start writing and when you aim to be
                                    finished. This timeframe is the foundation of your entire schedule.</p>
                            </div>
                            <div class="option-control">
                                <div class="form-row">
                                    <div class="half">
                                        <label class="static-label" style="font-size: 0.75rem; color: #64748b;">START
                                            DATE</label>
                                        <input type="date" [(ngModel)]="startDate" (change)="onDateChange()">
                                    </div>
                                    <div class="half">
                                        <label class="static-label" style="font-size: 0.75rem; color: #64748b;">END
                                            DATE</label>
                                        <input type="date" [(ngModel)]="endDate" (change)="onTargetFinishDateChange()">
                                    </div>
                                </div>
                                <div class="hint-box">
                                    <i class="fas fa-calendar-alt"></i>
                                    <span>Your project spans <strong>{{ totalDays }} days</strong>.</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ðŸŽ¯ Goal Definition -->
                <div class="planning-block">
                    <div class="block-header" (click)="sections.goalDefinition = !sections.goalDefinition">
                        <div class="title-group">
                            <div class="block-icon"><i class="fas fa-bullseye"></i></div>
                            <h2>Goal Definition</h2>
                        </div>
                        <i class="fas fa-chevron-down toggle-icon" [class.open]="sections.goalDefinition"></i>
                    </div>
                    <div class="block-content" *ngIf="sections.goalDefinition">
                        <div class="option-row">
                            <div class="option-label-group">
                                <label>Total Goal ({{ getUnitLabel(0) | titlecase }})</label>
                                <p class="explanation">Set the final destination for your project. This is the total
                                    number of {{ getUnitLabel(0) }} you want to complete by your deadline.</p>
                            </div>
                            <div class="option-control">
                                <input type="number" [(ngModel)]="targetWordCount" (ngModelChange)="onTargetChange()"
                                    placeholder="e.g. 50000">
                                <div class="hint-box" *ngIf="targetWordCount > 0">
                                    <i class="fas fa-tachometer-alt"></i>
                                    <span>Based on your timeline, you need to average <strong>{{ dailyAvg | number }}
                                            {{ getUnitLabel(dailyAvg) }}</strong> per day.</span>
                                </div>
                            </div>
                        </div>

                        <div class="option-row">
                            <div class="option-label-group">
                                <label>Measurement Unit</label>
                                <p class="explanation">Choose how you want to track your progress. Select the unit that
                                    best fits your project type and workflow.</p>
                            </div>
                            <div class="option-control">
                                <select [(ngModel)]="measurementUnit" class="form-control">
                                    <option value="feature">Features</option>
                                    <option value="word">Words</option>
                                    <option value="paragraph">Paragraphs</option>
                                    <option value="page">Pages</option>
                                    <option value="poem">Poems</option>
                                    <option value="chapter">Chapters</option>
                                    <option value="section">Sections</option>
                                    <option value="character">Characters</option>
                                    <option value="verse">Verses</option>
                                    <option value="act">Acts</option>
                                    <option value="scene">Scenes</option>
                                    <option value="stanza">Stanzas</option>
                                    <option value="line">Lines</option>
                                    <option value="book">Books</option>
                                    <option value="day">Days</option>
                                    <option value="hour">Hours</option>
                                    <option value="minute">Minutes</option>
                                    <option value="unit">Units</option>
                                    <option value="item">Items</option>
                                    <option value="task">Tasks</option>
                                    <option value="todo">Todos</option>
                                    <option value="step">Steps</option>
                                    <option value="entry">Entries</option>
                                    <option value="post">Posts</option>
                                    <option value="worksheet">Worksheets</option>
                                    <option value="dollar">Dollars</option>
                                    <option value="mile">Miles</option>
                                    <option value="km">Kilometers</option>
                                    <option value="lb">Pounds (lb)</option>
                                    <option value="kg">Kilograms (kg)</option>
                                    <option value="stitch">Stitches</option>
                                    <option value="time">Times</option>
                                    <option value="episode">Episodes</option>
                                    <option value="video">Videos</option>
                                    <option value="movie">Movies</option>
                                    <option value="lesson">Lessons</option>
                                </select>
                            </div>
                        </div>

                        <div class="option-row">
                            <div class="option-label-group">
                                <label>Starting Point</label>
                                <p class="explanation">Are you starting from scratch, or do you already have some
                                    progress? Entering a starting count ensures your total remains accurate.</p>
                            </div>
                            <div class="option-control">
                                <input type="number" [(ngModel)]="startingPoint" (ngModelChange)="onTargetChange()">
                            </div>
                        </div>
                    </div>
                </div>


                <!-- ðŸ—“ Writing Schedule Rules -->
                <div class="planning-block">
                    <div class="block-header" (click)="sections.scheduleRules = !sections.scheduleRules">
                        <div class="title-group">
                            <div class="block-icon"><i class="fas fa-calendar-check"></i></div>
                            <h2>Writing Schedule Rules</h2>
                        </div>
                        <i class="fas fa-chevron-down toggle-icon" [class.open]="sections.scheduleRules"></i>
                    </div>
                    <div class="block-content" *ngIf="sections.scheduleRules">

                        <div class="option-row">
                            <div class="option-label-group">
                                <label>Pace Algorithm</label>
                                <p class="explanation">Choose the "shape" of your writing journey. This algorithm
                                    determines if you write the same amount every day or if your workload changes.</p>
                            </div>
                            <div class="option-control">
                                <select [(ngModel)]="strategyType" (change)="onStrategyChange()">
                                    <option value="Steady">Steady â€” Write an equal amount every single day.</option>
                                    <option value="Back-load">Rising (Back-load) â€” Start small and increase your pace as
                                        you approach the deadline.</option>
                                    <option value="Front-load">Front-load â€” Start with high intensity and taper off
                                        towards the end.</option>
                                    <option value="Mountain">Mountain â€” Build up to a peak intensity mid-project, then
                                        gradually slow down.</option>
                                    <option value="Valley">Valley â€” Fast start, quiet middle, and a strong finish.
                                    </option>
                                    <option value="Oscillating">Oscillating â€” Alternate between high-intensity and
                                        low-intensity periods.</option>
                                    <option value="Randomly">Randomly â€” Every day is a surprise.</option>
                                </select>
                            </div>
                        </div>

                        <div class="option-row">
                            <div class="option-label-group">
                                <label>Strategy Intensity</label>
                                <p class="explanation">How dramatic should the changes in your daily targets be? Higher
                                    intensity leads to steeper increases or decreases in your daily {{ getUnitLabel(0)
                                    }} goals.</p>
                            </div>
                            <div class="option-control">
                                <select [(ngModel)]="strategyIntensity" (change)="onStrategyChange()">
                                    <option value="Gentle">Gentle</option>
                                    <option value="Low">Low</option>
                                    <option value="Average">Average</option>
                                    <option value="Medium">Medium</option>
                                    <option value="Hard Core">Hard Core</option>
                                </select>
                            </div>
                        </div>

                    </div>
                </div>




                <!-- âš™ï¸ Planning Preferences -->
                <div class="planning-block">
                    <div class="block-header" (click)="sections.preferences = !sections.preferences">
                        <div class="title-group">
                            <div class="block-icon"><i class="fas fa-sliders-h"></i></div>
                            <h2>Planning Preferences</h2>
                        </div>
                        <i class="fas fa-chevron-down toggle-icon" [class.open]="sections.preferences"></i>
                    </div>
                    <div class="block-content" *ngIf="sections.preferences">
                        <div class="option-row">
                            <div class="option-label-group">
                                <label>Fixed Deadline</label>
                                <p class="explanation">A fixed deadline forces the schedule to fit within your dates.
                                    Use this if you have a strict submission date or goal.</p>
                            </div>
                            <div class="option-control">
                                <div class="radio-group-modern">
                                    <label><input type="radio" [value]="true" [(ngModel)]="fixedDeadline"
                                            (change)="onFixedDeadlineChange()"> Strict</label>
                                    <label><input type="radio" [value]="false" [(ngModel)]="fixedDeadline"
                                            (change)="onFixedDeadlineChange()"> Flexible</label>
                                </div>
                                <div class="hint-box">
                                    <i class="fas fa-info-circle"></i>
                                    <span>{{ fixedDeadline ? 'Your end date will not move even if you fallback.' : 'Your
                                        deadline will automatically extend if you miss targets.' }}</span>
                                </div>
                            </div>
                        </div>

                        <div class="option-row">
                            <div class="option-label-group">
                                <label>Plan Privacy</label>
                                <p class="explanation">Decide who can see your writing progress. Private plans are only
                                    visible to you, while public plans can be shared with your community.</p>
                            </div>
                            <div class="option-control">
                                <div class="radio-group-modern">
                                    <label><input type="radio" [value]="true" [(ngModel)]="isPrivate"> Private</label>
                                    <label><input type="radio" [value]="false" [(ngModel)]="isPrivate"> Public</label>
                                </div>
                            </div>
                        </div>

                        <div class="option-row">
                            <div class="option-label-group">
                                <label>Theme Identity</label>
                                <p class="explanation">Personalize your project's visual identity. This color will be
                                    used for your charts, milestones, and dashboard cards.</p>
                            </div>
                            <div class="option-control">
                                <div class="color-picker-row"
                                    style="padding: 0.5rem; background: white; border: 1px solid #e2e8f0; border-radius: 12px; display: inline-flex; align-items: center; gap: 1rem;">
                                    <input type="color" [(ngModel)]="dashboardColor"
                                        style="width: 50px; height: 50px; border: none; background: none; cursor: pointer;">
                                    <span style="font-weight: 600; font-family: monospace; color: #64748b;">{{
                                        dashboardColor }}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ðŸ”„ Progress & Adjustment -->
                <div class="planning-block">
                    <div class="block-header" (click)="sections.progressBehavior = !sections.progressBehavior">
                        <div class="title-group">
                            <div class="block-icon"><i class="fas fa-tasks"></i></div>
                            <h2>Progress & Adjustment</h2>
                        </div>
                        <i class="fas fa-chevron-down toggle-icon" [class.open]="sections.progressBehavior"></i>
                    </div>
                    <div class="block-content" *ngIf="sections.progressBehavior">
                        <div class="option-row">
                            <div class="option-label-group">
                                <label>Adaptation Strategy</label>
                                <p class="explanation">Decide how the plan recalculates as you write. Auto-adjust will
                                    keep your finish date steady by changing future targets.</p>
                            </div>
                            <div class="option-control">
                                <div class="radio-group-modern">
                                    <label><input type="radio" value="adjust" [(ngModel)]="planAdjustment"> Auto-Adjust
                                        Plan</label>
                                    <label><input type="radio" value="fixed" [(ngModel)]="planAdjustment"> Stay
                                        Fixed</label>
                                </div>
                                <div class="hint-box">
                                    <i class="fas fa-magic"></i>
                                    <span>{{ planAdjustment === 'adjust' ? 'Plan will automatically redistribute
                                        missed/extra words.' : 'Targets remain exactly as originally scheduled.'
                                        }}</span>
                                </div>
                            </div>
                        </div>

                        <div class="option-row">
                            <div class="option-label-group">
                                <label>Recording Method</label>
                                <p class="explanation">Choose your preferred logging style. Whether you track your total
                                    novel's count or just what you wrote in a session.</p>
                            </div>
                            <div class="option-control">
                                <div class="radio-group-modern">
                                    <label><input type="radio" value="overall" [(ngModel)]="recordingType">
                                        Cumulative</label>
                                    <label><input type="radio" value="daily" [(ngModel)]="recordingType"> Daily
                                        Sprints</label>
                                </div>
                                <div class="hint-box">
                                    <i class="fas fa-save"></i>
                                    <span>{{ recordingType === 'overall' ? 'Record your total progress reached so far.'
                                        : 'Record exactly how much you completed today.' }}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Final Action -->
                <div style="display: flex; justify-content: center; margin-top: 1rem;">
                    <button class="btn-save" style="padding: 1.25rem 4rem; font-size: 1.125rem;" (click)="savePlan()"
                        [disabled]="isLoading">
                        {{ isEditMode ? 'Update My Plan' : 'Create My Writing Plan' }}
                    </button>
                </div>
            </div>

            <!-- Existing Schedule View -->
            <div *ngIf="viewMode === 'schedule'">
                <div class="schedule-summary">
                    <div class="word-badge">
                        <span class="count">{{ targetWordCount | number }} {{ getUnitLabel(targetWordCount) }}</span>
                        &nbsp;<span class="label">over</span>&nbsp;
                        <span class="days">{{ totalDays }} days</span>
                    </div>
                    <div class="timeline">
                        <span class="date">{{ startDate | date:'MM/dd/yyyy' }}</span>
                        <div class="line">
                            <span class="days-left">{{ daysLeft }} days left</span>
                        </div>
                        <span class="date">{{ endDate | date:'MM/dd/yyyy' }}</span>
                    </div>
                </div>

                <div [ngSwitch]="displayViewType">
                    <!-- Table View -->
                    <div *ngSwitchCase="'Table'" class="view-card table-view">
                        <table class="plan-table">
                            <thead>
                                <tr>
                                    <th>Num</th>
                                    <th>Day</th>
                                    <th>Date</th>
                                    <th>Work to Complete</th>
                                    <th>Actual Work Done</th>
                                    <th>Expected Progress</th>
                                    <th>Work Left</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr *ngFor="let day of paginatedPlanDays">
                                    <td>{{ day.num }}</td>
                                    <td>{{ day.day }}</td>
                                    <td>{{ day.date }}</td>
                                    <td><b>{{ day.workToComplete | number }}</b></td>
                                    <td>
                                        <input type="number" [(ngModel)]="day.actualWorkDone"
                                            (ngModelChange)="onTableProgressChange(day)" class="table-input"
                                            placeholder="0">
                                    </td>
                                    <td>{{ day.expectedProgress | number }}</td>
                                    <td>{{ day.workLeft | number }}</td>
                                </tr>
                            </tbody>
                        </table>

                        <!-- Pagination Controls -->
                        <div class="pagination-controls" *ngIf="totalPages > 1">
                            <button class="btn-page" [disabled]="currentPage === 1" (click)="prevPage()">
                                <i class="fas fa-chevron-left"></i> Previous
                            </button>

                            <span class="page-info">
                                Page {{ currentPage }} of {{ totalPages }}
                            </span>

                            <button class="btn-page" [disabled]="currentPage === totalPages" (click)="nextPage()">
                                Next <i class="fas fa-chevron-right"></i>
                            </button>
                        </div>
                    </div>

                    <!-- Calendar View -->
                    <div *ngSwitchCase="'Calendar'" class="view-card calendar-view">
                        <div class="calendar-header"
                            style="display: flex; justify-content: center; align-items: center; gap: 2rem; margin-bottom: 2rem;">
                            <button (click)="changeCalendarMonth(-1)" class="nav-btn"
                                style="background: var(--bg-surface); border: 1px solid var(--border-color); width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; color: var(--text-primary); transition: all 0.2s ease;">
                                <i class="fas fa-chevron-left"></i>
                            </button>
                            <h2
                                style="margin: 0; font-size: 1.75rem; font-weight: 700; color: var(--text-primary); min-width: 200px; text-align: center;">
                                {{ currentCalendarDate | date:'MMMM yyyy' }}
                            </h2>
                            <button (click)="changeCalendarMonth(1)" class="nav-btn"
                                style="background: var(--bg-surface); border: 1px solid var(--border-color); width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; color: var(--text-primary); transition: all 0.2s ease;">
                                <i class="fas fa-chevron-right"></i>
                            </button>
                        </div>
                        <div class="calendar-grid">
                            <!-- Day Labels -->
                            <ng-container *ngIf="weekStartDay === 'Mondays'">
                                <div class="day-label">Monday</div>
                                <div class="day-label">Tuesday</div>
                                <div class="day-label">Wednesday</div>
                                <div class="day-label">Thursday</div>
                                <div class="day-label">Friday</div>
                                <div class="day-label">Saturday</div>
                                <div class="day-label">Sunday</div>
                            </ng-container>
                            <ng-container *ngIf="weekStartDay !== 'Mondays'">
                                <div class="day-label">Sunday</div>
                                <div class="day-label">Monday</div>
                                <div class="day-label">Tuesday</div>
                                <div class="day-label">Wednesday</div>
                                <div class="day-label">Thursday</div>
                                <div class="day-label">Friday</div>
                                <div class="day-label">Saturday</div>
                            </ng-container>

                            <div *ngFor="let day of calendarDays" class="day-cell"
                                [class.other-month]="day.month !== 'current'"
                                [style.opacity]="day.month === 'current' ? 1 : 0.3"
                                style="display: flex; flex-direction: column; gap: 4px; padding: 8px; min-height: 100px; border: 1px solid var(--border-color); background: var(--bg-surface);">
                                <span class="date-num" [style.color]="day.isToday ? 'var(--primary-accent)' : 'inherit'"
                                    [style.fontWeight]="day.isToday ? '700' : '400'">
                                    {{ day.day }}
                                </span>

                                <!-- Goal Bubble -->
                                <div class="word-bubble" *ngIf="day.workToComplete > 0"
                                    style="background: #1C2E4A; color: white; padding: 4px 8px; border-radius: 0px; font-size: 0.7rem; font-weight: 600; width: 100%; box-sizing: border-box; text-align: left;">
                                    <div style="opacity: 0.7; font-size: 0.6rem; text-transform: uppercase;">GOAL</div>
                                    {{ day.workToComplete | number }} {{ getUnitLabel(day.workToComplete) }}
                                </div>

                                <!-- Actual Progress Bubble (Show only if progress exists) -->
                                <div class="word-bubble" *ngIf="day.actualWorkDone > 0"
                                    style="background: #10b981; color: white; padding: 4px 8px; border-radius: 0px; font-size: 0.7rem; font-weight: 600; width: 100%; box-sizing: border-box; text-align: left;">
                                    <div style="opacity: 0.8; font-size: 0.6rem; text-transform: uppercase;">ACTUAL
                                    </div>
                                    {{ day.actualWorkDone | number }} {{ getUnitLabel(day.actualWorkDone) }}
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Graph View (Redesigned) -->
                    <div *ngSwitchCase="'Graph'" class="view-card graph-view"
                        style="background: transparent; padding: 0; box-shadow: none; border: none;">

                        <!-- Chart 1: Plan Cumulative Growth -->
                        <div class="chart-card-clean">
                            <div class="chart-header">
                                <h3>Plan Cumulative Growth</h3>
                                <div class="chart-legend">
                                    <span class="dot" [style.background]="dashboardColor"></span>
                                    Cumulative Progress
                                </div>
                            </div>

                            <!-- Overall Progress Chart -->
                            <div class="chart-body">
                                <app-output-stats-chart [data]="scheduledWorkData"
                                    [color]="selectedColor || dashboardColor" [unit]="measurementUnit"
                                    [pluralUnit]="getUnitLabel(0)">
                                </app-output-stats-chart>
                            </div>
                        </div>

                    </div>

                    <!-- Bar View -->
                    <div *ngSwitchCase="'Bar'" class="view-card"
                        style="background: transparent; padding: 0; box-shadow: none; border: none;">
                        <div class="chart-card-clean">
                            <div class="chart-header">
                                <div class="header-left">
                                    <h3>Daily Progress vs. Target</h3>
                                    <p class="chart-subtitle">How your daily performance stacks up against your target
                                    </p>
                                </div>
                                <div class="chart-legend">
                                    <span class="dot" [style.background]="selectedColor || dashboardColor"></span>
                                    Planned Target
                                </div>
                            </div>
                            <div class="chart-body">
                                <app-daily-stats-chart [data]="scheduledWorkData" mode="bar"
                                    [color]="selectedColor || dashboardColor" [useSlicing]="false"
                                    [unit]="measurementUnit" [pluralUnit]="getUnitLabel(0)">
                                </app-daily-stats-chart>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Progress Tab View -->
            <div *ngIf="viewMode === 'progress'" class="progress-view-redesign">

                <!-- ðŸ“Š Redesigned Overall Completion Card -->
                <div class="progress-completion-card">
                    <div class="card-header-label">OVERALL COMPLETION</div>
                    <div class="stats-row">
                        <div class="percentage">{{ currentProgress }}%</div>
                        <div class="word-counts">
                            {{ totalWordsLogged | number }} / {{ targetWordCount | number }} {{
                            getUnitLabel(targetWordCount) }}
                        </div>
                    </div>
                    <div class="progress-bar-container">
                        <div class="progress-bar-bg">
                            <div class="progress-bar-fill" [style.width.%]="currentProgress"></div>
                        </div>
                    </div>
                </div>

                <div class="progress-list-section mt-6">
                    <div class="section-header">
                        <h3>Daily Updates</h3>
                        <p>Your recent writing history</p>
                    </div>

                    <div class="progress-grid" *ngIf="getSortedProgressEntries().length > 0">
                        <div class="progress-update-card" *ngFor="let entry of getSortedProgressEntries()">
                            <div class="card-left">
                                <div class="entry-date">{{ entry.date | date:'EEE, MMM d' }}</div>
                                <div class="entry-target" style="font-size: 0.8rem; color: #94a3b8;">Target: {{
                                    entry.targetWords | number }}</div>
                            </div>
                            <div class="card-right">
                                <div class="entry-words" [class.over]="entry.actualWords >= entry.targetWords">
                                    {{ entry.actualWords | number }}
                                    <span class="unit">{{ getUnitLabel(entry.actualWords) }}</span>
                                </div>
                                <div class="entry-trend" [ngSwitch]="entry.trend">
                                    <i *ngSwitchCase="'up'" class="fas fa-caret-up text-success"></i>
                                    <i *ngSwitchCase="'down'" class="fas fa-caret-down text-danger"></i>
                                    <i *ngSwitchCase="'steady'" class="fas fa-minus text-muted"></i>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="empty-state" *ngIf="getSortedProgressEntries().length === 0">
                        <i class="fas fa-pencil-alt"></i>
                        <p>No writing history logged yet.</p>
                        <p class="sub">Update your progress using the table or chart to see your history here.</p>
                    </div>
                </div>

            </div>

            <!-- Stats Tab View -->
            <div *ngIf="viewMode === 'stats'" class="stats-view-content">
                <!-- Performance Overview Visual -->
                <div class="performance-visual-row">
                    <!-- Completion Donut -->
                    <div class="visual-card completion-card">
                        <div class="card-title">Project Completion</div>
                        <div class="donut-wrapper">
                            <svg viewBox="0 0 100 100" class="donut-svg">
                                <circle cx="50" cy="50" r="40" class="donut-track"></circle>
                                <circle cx="50" cy="50" r="40" class="donut-fill"
                                    [style.stroke-dashoffset]="251.2 * (1 - currentProgress / 100)"></circle>
                            </svg>
                            <div class="donut-content">
                                <span class="percent">{{ currentProgress }}%</span>
                                <span class="label">Done</span>
                            </div>
                        </div>
                        <div class="completion-stats">
                            <div class="stat">
                                <span class="val">{{ totalWordsLogged | number }}</span>
                                <span class="lbl">{{ getUnitLabel(0) | titlecase }} Logged</span>
                            </div>
                            <div class="stat">
                                <span class="val">{{ wordsRemaining | number }}</span>
                                <span class="lbl">{{ getUnitLabel(0) | titlecase }} Left</span>
                            </div>
                        </div>
                    </div>

                    <!-- Highlight Metrics -->
                    <div class="metrics-column">
                        <div class="metric-mini-card">
                            <div class="top">
                                <i class="fas fa-bullseye"></i>
                                <span>Daily Target</span>
                            </div>
                            <div class="value">{{ dailyAvg | number }}</div>
                        </div>
                        <div class="metric-mini-card">
                            <div class="top">
                                <i class="fas fa-calendar-check"></i>
                                <span>On Track Status</span>
                            </div>
                            <div class="value">{{ onTrackStatus }}</div>
                            <div class="subtext">{{ onTrackPercent }}% performance</div>
                        </div>
                        <div class="metric-mini-card">
                            <div class="top">
                                <i class="fas fa-trophy"></i>
                                <span>Best Day</span>
                            </div>
                            <div class="value" *ngIf="bestDay">{{ bestDay.count | number }}</div>
                            <div class="value" *ngIf="!bestDay">0</div>
                            <div class="subtext">{{ bestDay?.date || 'No data' }}</div>
                        </div>
                    </div>
                </div>

                <!-- Daily comparison Chart -->
                <div class="chart-card daily-performance-chart mt-6">
                    <div class="card-header">
                        <div class="title-group">
                            <h3>Goal vs. Actual Progress</h3>
                            <p>A day-by-day comparison of your writing output against your plan</p>
                        </div>
                    </div>
                    <app-daily-stats-chart [data]="chartData" [useSlicing]="false" [unit]="measurementUnit"
                        [pluralUnit]="getUnitLabel(0)"></app-daily-stats-chart>
                </div>

                <!-- Secondary Stats Grid -->
                <div class="stats-averages-section mt-6">
                    <div class="averages-grid">
                        <div class="avg-item">
                            <span class="label">Weekly Goal</span>
                            <span class="value">{{ weeklyAvg | number }}</span>
                        </div>
                        <div class="avg-item">
                            <span class="label">Weekday Target</span>
                            <span class="value">{{ weekdayAvg | number }}</span>
                        </div>
                        <div class="avg-item">
                            <span class="label">Weekend Target</span>
                            <span class="value">{{ weekendAvg | number }}</span>
                        </div>
                        <div class="avg-item">
                            <span class="label">Projected Days</span>
                            <span class="value">{{ totalDays }}</span>
                        </div>
                    </div>
                </div>

                <!-- Cumulative Chart for Plan -->
                <div class="chart-card plan-growth-chart">
                    <div class="card-header">
                        <h3>Plan Cumulative Growth</h3>
                        <div class="chart-legend">
                            <span class="dot"></span> Cumulative Progress
                        </div>
                    </div>
                    <app-output-stats-chart [data]="chartData" [totalTarget]="targetWordCount"
                        [color]="selectedColor || dashboardColor" [unit]="measurementUnit"
                        [pluralUnit]="getUnitLabel(0)"></app-output-stats-chart>
                </div>
            </div>
        </main>
    </div>
</div>