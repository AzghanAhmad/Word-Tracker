<div class="community-container">

    <!-- Loading State -->
    <app-content-loader *ngIf="isLoading"></app-content-loader>

    <ng-container *ngIf="!isLoading">
        <!-- Filters Bar (Top) -->
        <div class="filter-bar">
            <div class="filter-item">
                <label>Activity Being Done</label>
                <div class="select-wrapper">
                    <select [(ngModel)]="selectedActivity" (change)="applyFilters()">
                        <option *ngFor="let act of activities" [value]="act">{{ act }}</option>
                    </select>
                </div>
            </div>
            <div class="filter-item">
                <label>Content Created</label>
                <div class="select-wrapper">
                    <select [(ngModel)]="selectedContent" (change)="applyFilters()">
                        <option *ngFor="let type of contentTypes" [value]="type">{{ type }}</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Cards Grid -->
        <div class="cards-grid">
            <div class="plan-card" *ngFor="let plan of filteredPlans">

                <!-- Header Strip -->
                <div class="card-header">
                    <span class="left-stat">{{ plan.goal_amount | number }} {{ plan.goal_unit }}</span>
                    <span class="right-stat">{{ plan.progress_percent }}% Done</span>
                </div>

                <!-- Graph Area -->
                <div class="card-graph">
                    <svg viewBox="0 0 280 60" preserveAspectRatio="none">
                        <!-- Sparkline Path -->
                        <path [attr.d]="plan.graph_path" fill="none" stroke="#7dd3fc" stroke-width="2"
                            vector-effect="non-scaling-stroke" />

                        <!-- Interactive Points -->
                        <g *ngFor="let point of plan.graph_points; let i = index" class="data-point-group">
                            <!-- Visible Dot (on hover) -->
                            <circle [attr.cx]="point.x" [attr.cy]="point.y" r="3" class="visible-dot" />

                            <!-- Hit Area (transparent target) -->
                            <circle [attr.cx]="point.x" [attr.cy]="point.y" r="10" fill="transparent" class="hit-area" />

                            <!-- Tooltip -->
                            <g class="tooltip-box">
                                <rect [attr.x]="point.x - 22" [attr.y]="point.y - 30" width="44" height="20" rx="4"
                                    fill="#0f172a" opacity="0.9" />
                                <text [attr.x]="point.x" [attr.y]="point.y - 16" text-anchor="middle" fill="#fff"
                                    font-size="11" font-weight="600">{{ point.value | number }}</text>
                            </g>
                        </g>
                    </svg>
                </div>

                <!-- Footer Info -->
                <div class="card-footer">
                    <div class="plan-name">{{ plan.title }}</div>
                    <div class="author-info">{{ plan.content_type }} by {{ plan.creator_username }}</div>
                </div>
            </div>

            <!-- Empty State -->
            <div class="empty-state" *ngIf="filteredPlans.length === 0">
                <p>No public plans found. Create a public plan to share with the community!</p>
            </div>
        </div>
    </ng-container>
</div>