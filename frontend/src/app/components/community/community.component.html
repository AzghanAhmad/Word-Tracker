<div class="community-container">
    <div class="header">
        <h2>Community Plans</h2>
    </div>

    <div class="feature-explanation">
        <div class="explanation-icon">
            <i class="fas fa-users"></i>
        </div>
        <div class="explanation-content">
            <h3>Learn from Fellow Authors</h3>
            <p>Community Plans are public templates shared by other writers. Explore how others structure their goals,
                compare different writing strategies, and use these plans as inspiration for your own projects. You can
                share your own plans by making them "Public" in your plan settings.</p>
        </div>
    </div>

    <!-- Loading State -->
    <app-content-loader *ngIf="isLoading"></app-content-loader>

    <ng-container *ngIf="!isLoading">
        <!-- Filters Bar (Top) -->
        <div class="filter-bar">
            <div class="filter-item">
                <label>Activity Being Done</label>
                <div class="select-wrapper">
                    <select [(ngModel)]="selectedActivity" (change)="applyFilters()">
                        <option *ngFor="let act of activities" [value]="act">{{ act }}</option>
                    </select>
                </div>
            </div>
            <div class="filter-item">
                <label>Content Created</label>
                <div class="select-wrapper">
                    <select [(ngModel)]="selectedContent" (change)="applyFilters()">
                        <option *ngFor="let type of contentTypes" [value]="type">{{ type }}</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Cards Grid -->
        <div class="cards-grid">
            <div class="plan-card" *ngFor="let plan of paginatedPlans">

                <!-- Header Strip -->
                <div class="card-header">
                    <span class="left-stat">{{ plan.goal_amount | number }} {{ plan.goal_unit }}</span>
                    <span class="right-stat">{{ plan.progress_percent }}% Done</span>
                </div>

                <!-- Graph Area -->
                <div class="card-graph">
                    <svg viewBox="0 0 280 60" preserveAspectRatio="none">
                        <!-- Sparkline Path -->
                        <path [attr.d]="plan.graph_path" fill="none" stroke="#7dd3fc" stroke-width="2"
                            vector-effect="non-scaling-stroke" />

                        <!-- Interactive Points -->
                        <g *ngFor="let point of plan.graph_points; let i = index" class="data-point-group">
                            <!-- Visible Dot (on hover) -->
                            <circle [attr.cx]="point.x" [attr.cy]="point.y" r="3" class="visible-dot" />

                            <!-- Hit Area (transparent target) -->
                            <circle [attr.cx]="point.x" [attr.cy]="point.y" r="10" fill="transparent"
                                class="hit-area" />

                            <!-- Tooltip -->
                            <g class="tooltip-box">
                                <rect [attr.x]="point.x - 22" [attr.y]="point.y - 30" width="44" height="20" rx="4"
                                    fill="#0f172a" opacity="0.9" />
                                <text [attr.x]="point.x" [attr.y]="point.y - 16" text-anchor="middle" fill="#fff"
                                    font-size="11" font-weight="600">{{ point.value | number }}</text>
                            </g>
                        </g>
                    </svg>
                </div>

                <!-- Footer Info -->
                <div class="card-footer">
                    <div class="plan-name">{{ plan.title }}</div>
                    <div class="author-info">{{ plan.content_type }} by {{ plan.creator_username }}</div>
                </div>
            </div>

            <!-- Empty State -->
            <div class="empty-state" *ngIf="filteredPlans.length === 0">
                <p>No public plans found. Create a public plan to share with the community!</p>
            </div>
        </div>

        <!-- Pagination -->
        <div class="pagination-container" *ngIf="totalPages > 1"
            style="display: flex; justify-content: center; align-items: center; gap: 1rem; margin-top: 2rem; padding: 1rem;">
            <button class="page-btn prev" [disabled]="currentPage === 1" (click)="setPage(currentPage - 1)"
                style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid #e2e8f0; background: white; cursor: pointer;">
                Previous
            </button>
            <div class="page-numbers" style="display: flex; gap: 0.5rem;">
                <ng-container *ngFor="let page of getPages()">
                    <button *ngIf="page !== '...'" class="page-num" [class.active]="currentPage === page"
                        (click)="setPage(page)" [style.background]="currentPage === page ? '#1C2E4A' : 'white'"
                        [style.color]="currentPage === page ? 'white' : '#1e293b'"
                        style="width: 32px; height: 32px; border-radius: 6px; border: 1px solid #e2e8f0; cursor: pointer;">
                        {{ page }}
                    </button>
                    <span *ngIf="page === '...'" class="page-dots">...</span>
                </ng-container>
            </div>
            <button class="page-btn next" [disabled]="currentPage === totalPages" (click)="setPage(currentPage + 1)"
                style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid #e2e8f0; background: white; cursor: pointer;">
                Next
            </button>
        </div>
    </ng-container>
</div>