<div class="organization-container">
    <div class="header">
        <h2>Organization Plans</h2>
        <button class="btn-primary" (click)="toggleCreateForm()" *ngIf="!showCreateForm && !showEditForm">
            <i class="fas fa-plus"></i> Organization Plan
        </button>
    </div>

    <!-- Error Message -->
    <div class="error-message" *ngIf="errorMessage">
        <i class="fas fa-exclamation-circle"></i>
        <span>{{ errorMessage }}</span>
        <button class="close-error" (click)="errorMessage = ''">
            <i class="fas fa-times"></i>
        </button>
    </div>

    <!-- Creation Form -->
    <div class="create-form-container" *ngIf="showCreateForm">
        <div class="form-card">
            <div class="form-group row">
                <label class="col-label">Name</label>
                <div class="col-input">
                    <input type="text" [(ngModel)]="newProject.name" placeholder="Name" maxlength="255">
                    <span class="help-text">Required, max 255 characters</span>
                </div>
            </div>

            <div class="form-group row">
                <label class="col-label">Short Tagline</label>
                <div class="col-input">
                    <input type="text" [(ngModel)]="newProject.subtitle" placeholder="Tagline" maxlength="255">
                    <span class="help-text">Optional, max 255 characters</span>
                </div>
            </div>

            <div class="form-group row">
                <label class="col-label">Description</label>
                <div class="col-input">
                    <textarea [(ngModel)]="newProject.description" placeholder="Description"
                        maxlength="1000"></textarea>
                    <span class="help-text">Optional, max 1000 characters</span>
                </div>
            </div>

            <div class="form-group row">
                <label class="col-label">Privacy</label>
                <div class="col-input">
                    <div class="privacy-toggle-modern" (click)="newProject.is_private = !newProject.is_private">
                        <div class="toggle-switch" [class.active]="newProject.is_private">
                            <div class="slider"></div>
                        </div>
                        <div class="toggle-info">
                            <span class="toggle-label">
                                <i class="fas" [ngClass]="newProject.is_private ? 'fa-lock' : 'fa-globe-americas'"></i>
                                {{ newProject.is_private ? 'Private Project' : 'Public Project' }}
                            </span>
                            <span class="toggle-sublabel">{{ newProject.is_private ? 'Visible only to organization
                                members' : 'Visible to everyone' }}</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="form-actions-bar">
                <button class="btn-save" (click)="createProject()" [disabled]="!newProject.name?.trim() || isLoading">
                    <i class="fas fa-spinner fa-spin" *ngIf="isLoading"></i>
                    <span *ngIf="!isLoading">Save This Project</span>
                    <span *ngIf="isLoading">Saving...</span>
                </button>
                <button class="btn-archive" (click)="toggleCreateForm()" [disabled]="isLoading">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Edit Form -->
    <div class="create-form-container" *ngIf="showEditForm && selectedProject">
        <div class="form-card">
            <h3 style="margin-bottom: 1.5rem;">Edit Project</h3>

            <div class="form-group row">
                <label class="col-label">Name</label>
                <div class="col-input">
                    <input type="text" [(ngModel)]="selectedProject.name" placeholder="Name" maxlength="255">
                    <span class="help-text">Required, max 255 characters</span>
                </div>
            </div>

            <div class="form-group row">
                <label class="col-label">Short Tagline</label>
                <div class="col-input">
                    <input type="text" [(ngModel)]="selectedProject.subtitle" placeholder="Tagline" maxlength="255">
                    <span class="help-text">Optional, max 255 characters</span>
                </div>
            </div>

            <div class="form-group row">
                <label class="col-label">Description</label>
                <div class="col-input">
                    <textarea [(ngModel)]="selectedProject.description" placeholder="Description"
                        maxlength="1000"></textarea>
                    <span class="help-text">Optional, max 1000 characters</span>
                </div>
            </div>

            <div class="form-group row">
                <label class="col-label">Privacy</label>
                <div class="col-input">
                    <div class="privacy-toggle-modern"
                        (click)="selectedProject.is_private = !selectedProject.is_private">
                        <div class="toggle-switch" [class.active]="selectedProject.is_private">
                            <div class="slider"></div>
                        </div>
                        <div class="toggle-info">
                            <span class="toggle-label">
                                <i class="fas"
                                    [ngClass]="selectedProject.is_private ? 'fa-lock' : 'fa-globe-americas'"></i>
                                {{ selectedProject.is_private ? 'Private Project' : 'Public Project' }}
                            </span>
                            <span class="toggle-sublabel">{{ selectedProject.is_private ? 'Visible only to organization
                                members' : 'Visible to everyone' }}</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="form-actions-bar">
                <button class="btn-save" (click)="updateProject()"
                    [disabled]="!selectedProject.name?.trim() || isLoading">
                    <i class="fas fa-spinner fa-spin" *ngIf="isLoading"></i>
                    <span *ngIf="!isLoading">Update Project</span>
                    <span *ngIf="isLoading">Updating...</span>
                </button>
                <button class="btn-archive" (click)="cancelEdit()" [disabled]="isLoading">Cancel</button>
            </div>
        </div>
    </div>

    <div class="loading-spinner" *ngIf="isLoading && !showCreateForm && !showEditForm">
        <i class="fas fa-spinner fa-spin"></i> Loading...
    </div>

    <div class="projects-grid" *ngIf="!isLoading && !showCreateForm && !showEditForm">
        <div class="empty-state" *ngIf="projects.length === 0">
            <p>No projects found. Create one to get started!</p>
        </div>

        <div class="project-card" *ngFor="let project of projects">
            <div class="project-info" (click)="viewProjectDetails(project)">
                <h3>{{ project.name }}</h3>
                <p class="subtitle" *ngIf="project.subtitle">{{ project.subtitle }}</p>
                <p class="description" *ngIf="project.description">{{ project.description }}</p>
                <span class="badge-private" *ngIf="project.is_private"><i class="fas fa-lock"></i> Private</span>
                <span class="created-date" *ngIf="project.created_at">
                    Created: {{ project.created_at | date:'short' }}
                </span>
            </div>
            <div class="project-actions">
                <button class="btn-icon" (click)="editProject(project); $event.stopPropagation()" title="Edit">
                    <i class="fas fa-edit"></i>
                </button>
                <button class="btn-icon btn-archive" (click)="archiveProject(project); $event.stopPropagation()"
                    title="Archive">
                    <i class="fas fa-archive"></i>
                </button>
                <button class="btn-icon btn-delete" (click)="deleteProject(project); $event.stopPropagation()"
                    title="Delete">
                    <i class="fas fa-trash"></i>
                </button>
            </div>
        </div>
    </div>
</div>