<div class="create-plan-redesign">
    <!-- Header -->
    <header class="plan-header">
        <div class="title-section">
            <h1 *ngIf="!planName">Edit me: A Brand New Goal!</h1>
            <h1 *ngIf="planName">{{ planName }}</h1>
            <p class="subtitle">{{ contentType }} Drafting</p>
        </div>
        <div class="header-actions">
            <button class="btn-done" (click)="cancel()">
                <i class="fas fa-chart-bar"></i> Done Editing
            </button>
            <button class="btn-save" (click)="savePlan()">
                <i class="fas fa-save"></i> Save
            </button>
            <div class="share-dropdown">
                <button class="btn-share">Share <i class="fas fa-caret-down"></i></button>
            </div>
        </div>
    </header>

    <!-- Tabs Navigation -->
    <nav class="plan-tabs">
        <button [class.active]="viewMode === 'schedule'" (click)="viewMode = 'schedule'">Schedule</button>
        <button [class.active]="viewMode === 'progress'" (click)="viewMode = 'progress'">Progress</button>
        <button [class.active]="viewMode === 'stats'" (click)="viewMode = 'stats'">Stats</button>
    </nav>

    <div class="plan-content">
        <!-- Sidebar -->
        <aside class="plan-sidebar">
            <div class="sidebar-card">
                <div class="card-header">
                    <span>Plan Info</span>
                    <i class="fas fa-arrows-alt-v"></i>
                </div>
                <div class="card-body">
                    <div class="form-group">
                        <label>Name</label>
                        <input type="text" placeholder="e.g. November Nanowrimo Novel" [(ngModel)]="planName">
                    </div>
                    <div class="form-row">
                        <div class="form-group half">
                            <label>Target word count :</label>
                            <input type="number" [(ngModel)]="targetWordCount" (ngModelChange)="onTargetChange()">
                        </div>
                        <div class="form-group half">
                            <label>Content type :</label>
                            <select [(ngModel)]="contentType">
                                <option value="Novella">Novella</option>
                                <option value="Novel">Novel</option>
                                <option value="Epic">Epic</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group half">
                            <label>Start Date :</label>
                            <input type="date" [(ngModel)]="startDate" (change)="onDateChange()">
                        </div>
                        <div class="form-group half">
                            <label>End Date :</label>
                            <input type="date" [(ngModel)]="endDate" (change)="onDateChange()">
                        </div>
                    </div>
                    <div class="project-org">
                        <label>Project Organization</label>
                        <p class="hint">Save this plan before adding to a project</p>
                    </div>
                </div>
            </div>

            <!-- Plan Description -->
            <div class="sidebar-card">
                <div class="card-header">
                    <h3>Plan Description</h3>
                    <i class="fas fa-arrows-alt-v"></i>
                </div>
                <div class="card-body">
                    <div class="privacy-toggle">
                        <i class="fas fa-lock"></i>
                        <input type="checkbox" [(ngModel)]="isPrivate">
                        <span>Make this plan private</span>
                    </div>
                    <div class="description-stats">
                        <span>0 words / <b>Max 300 words</b></span>
                    </div>
                    <div class="editor-toolbar">
                        <button><i class="fas fa-bold"></i></button>
                        <button><i class="fas fa-italic"></i></button>
                        <button><i class="fas fa-link"></i></button>
                        <button><i class="fas fa-paragraph"></i></button>
                        <button><i class="fas fa-list-ul"></i></button>
                        <button><i class="fas fa-list-ol"></i></button>
                        <button><i class="fas fa-align-left"></i></button>
                        <button><i class="fas fa-align-center"></i></button>
                        <button><i class="fas fa-align-right"></i></button>
                    </div>
                    <textarea [(ngModel)]="planDescription" placeholder="Enter a description"></textarea>
                </div>
            </div>

            <!-- Goals Section -->
            <div class="sidebar-card">
                <div class="card-header">
                    <h3>Goals</h3>
                    <i class="fas fa-arrows-alt-v"></i>
                </div>
                <div class="card-body">
                    <div class="form-row">
                        <div class="form-group half">
                            <label>Starting Point <i class="fas fa-info-circle"></i></label>
                            <input type="number" [(ngModel)]="startingPoint">
                        </div>
                        <div class="form-group half">
                            <label>Target</label>
                            <input type="number" [(ngModel)]="targetWordCount">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>How It's Measured</label>
                        <select [(ngModel)]="measurementUnit">
                            <option value="words">words</option>
                            <option value="pages">pages</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Is this an overall goal or a daily target : <i class="fas fa-info-circle"></i></label>
                        <div class="radio-group">
                            <label><input type="radio" [value]="false" [(ngModel)]="isDailyTarget"> Overall
                                Target</label>
                            <label><input type="radio" [value]="true" [(ngModel)]="isDailyTarget"> Daily</label>
                        </div>
                    </div>
                    <div class="date-info">
                        <span>Your Start Date: {{startDate || '12/19/2025'}}</span>
                    </div>
                    <div class="form-group">
                        <label>Fixed deadline?</label>
                        <div class="radio-group">
                            <label><input type="radio" [value]="true" [(ngModel)]="fixedDeadline"> Yes</label>
                            <label><input type="radio" [value]="false" [(ngModel)]="fixedDeadline"> No</label>
                        </div>
                    </div>
                    <div class="date-info">
                        <span>Target Finish Date: {{targetFinishDate || '01/18/2026'}}</span>
                    </div>
                </div>
            </div>




            <!-- Display Section -->
            <div class="sidebar-card">
                <div class="card-header">
                    <h3>Display</h3>
                    <i class="fas fa-arrows-alt-v"></i>
                </div>
                <div class="card-body">
                    <div class="form-group">
                        <label>View as :</label>
                        <div class="view-type-grid">
                            <button [class.active]="displayViewType === 'Table'" (click)="displayViewType = 'Table'">
                                <i class="fas fa-list"></i>
                                <span>Table</span>
                            </button>
                            <button [class.active]="displayViewType === 'Graph'" (click)="displayViewType = 'Graph'">
                                <i class="fas fa-chart-line"></i>
                                <span>Graph</span>
                            </button>
                            <button [class.active]="displayViewType === 'Calendar'"
                                (click)="displayViewType = 'Calendar'">
                                <i class="fas fa-calendar-alt"></i>
                                <span>Calendar</span>
                            </button>
                            <button [class.active]="displayViewType === 'Bar'" (click)="displayViewType = 'Bar'">
                                <i class="fas fa-chart-bar"></i>
                                <span>Bar</span>
                            </button>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Weeks begin on :</label>
                        <div class="radio-group-horizontal">
                            <label><input type="radio" value="Sundays" [(ngModel)]="weekStartDay"> Sundays</label>
                            <label><input type="radio" value="Mondays" [(ngModel)]="weekStartDay"> Mondays</label>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Group schedule and progress by :</label>
                        <div class="radio-group-horizontal flex-wrap">
                            <label><input type="radio" value="Day" [(ngModel)]="groupingType"
                                    (change)="onStrategyChange()"> Day</label>
                            <label><input type="radio" value="Week" [(ngModel)]="groupingType"
                                    (change)="onStrategyChange()"> Week</label>
                            <label><input type="radio" value="Month" [(ngModel)]="groupingType"
                                    (change)="onStrategyChange()"> Month</label>
                            <label><input type="radio" value="Year" [(ngModel)]="groupingType"
                                    (change)="onStrategyChange()"> Year</label>
                        </div>
                    </div>

                    <div class="form-group color-picker-row">
                        <label>Color on Dashboard Calendar :</label>
                        <input type="color" [(ngModel)]="dashboardColor" class="dashboard-color-input">
                    </div>
                </div>
            </div>

            <!-- Progress Section -->
            <div class="sidebar-card">
                <div class="card-header">
                    <h3>Progress</h3>
                    <i class="fas fa-arrows-alt-v"></i>
                </div>
                <div class="card-body">
                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" [(ngModel)]="showHistoricalData">
                            Show historical data
                        </label>
                    </div>
                    <div class="form-group">
                        <label>Tracking Type</label>
                        <select [(ngModel)]="progressTrackingType">
                            <option value="Daily Goals">Daily Goals</option>
                            <option value="Session Based">Session Based</option>
                            <option value="Milestones">Milestones</option>
                        </select>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="plan-main">
            <!-- Schedule/Stats View -->
            <div *ngIf="viewMode === 'schedule' || viewMode === 'stats'">
                <div class="schedule-summary">
                    <div class="word-badge">
                        <span class="count">{{ targetWordCount | number }} words</span>
                        <span class="label">over</span>
                        <span class="days">{{ totalDays }} days</span>
                    </div>
                    <div class="timeline">
                        <span class="date">{{ startDate | date:'MM/dd/yyyy' }}</span>
                        <div class="line">
                            <span class="days-left">{{ daysLeft }} days left</span>
                        </div>
                        <span class="date">{{ endDate | date:'MM/dd/yyyy' }}</span>
                    </div>
                </div>

                <div [ngSwitch]="displayViewType">
                    <!-- Table View -->
                    <div *ngSwitchCase="'Table'" class="view-card table-view">
                        <table class="plan-table">
                            <thead>
                                <tr>
                                    <th>Num</th>
                                    <th>Day</th>
                                    <th>Date</th>
                                    <th>Work to Complete</th>
                                    <th>Actual Work Done</th>
                                    <th>Expected Progress</th>
                                    <th>Your Actual Progress</th>
                                    <th>Work Left</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr *ngFor="let day of planDays">
                                    <td>{{ day.num }}</td>
                                    <td>{{ day.day }}</td>
                                    <td>{{ day.date }}</td>
                                    <td><b>{{ day.workToComplete | number }}</b></td>
                                    <td>{{ day.actualWorkDone }}</td>
                                    <td>{{ day.expectedProgress | number }}</td>
                                    <td>{{ day.yourActualProgress }}</td>
                                    <td>{{ day.workLeft | number }}</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <!-- Calendar View -->
                    <div *ngSwitchCase="'Calendar'" class="view-card calendar-view">
                        <div class="calendar-header">
                            <h2>{{ startDate | date:'MMMM' }}</h2>
                        </div>
                        <div class="calendar-grid">
                            <div class="day-label">Monday</div>
                            <div class="day-label">Tuesday</div>
                            <div class="day-label">Wednesday</div>
                            <div class="day-label">Thursday</div>
                            <div class="day-label">Friday</div>
                            <div class="day-label">Saturday</div>
                            <div class="day-label">Sunday</div>

                            <div *ngFor="let day of planDays" class="day-cell">
                                <span class="date-num">{{ day.dateObj | date:'dd' }}</span>
                                <div class="word-bubble" [style.background]="dashboardColor">
                                    {{ day.workToComplete | number }} words
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Graph View -->
                    <div *ngSwitchCase="'Graph'" class="view-card graph-view">
                        <div class="chart-container">
                            <h3 class="chart-title">Daily Work</h3>
                            <div class="svg-container">
                                <svg viewBox="0 0 800 200" preserveAspectRatio="none" class="chart-svg">
                                    <!-- Grid Lines -->
                                    <line *ngFor="let line of getGridLines(getMaxDailyTarget())" x1="0"
                                        [attr.y1]="getYPos(line, getMaxDailyTarget())" x2="800"
                                        [attr.y2]="getYPos(line, getMaxDailyTarget())" class="grid-line"></line>

                                    <path [attr.d]="getLinePath()" fill="none" class="target-path"></path>

                                    <!-- Data Dots -->
                                    <circle *ngFor="let pt of getDailyPoints()" [attr.cx]="pt.x" [attr.cy]="pt.y" r="4"
                                        class="data-dot" (mouseenter)="hoveredDay = pt.day"
                                        (mouseleave)="hoveredDay = null"></circle>
                                </svg>

                                <div class="chart-axes">
                                    <div class="y-axis">
                                        <span *ngFor="let line of getGridLines(getMaxDailyTarget()).reverse()"
                                            class="axis-label">{{ line | number:'1.0-1' }}</span>
                                    </div>
                                    <div class="x-axis">
                                        <ng-container *ngFor="let day of planDays; let i = index">
                                            <span *ngIf="i % (totalDays > 10 ? 3 : 1) === 0" class="axis-label">{{
                                                day.dateObj
                                                | date:'yyyy-MM-dd' }}</span>
                                        </ng-container>
                                    </div>
                                </div>

                                <!-- Tooltip Popover -->
                                <div *ngIf="hoveredDay" class="chart-tooltip"
                                    [style.left.px]="(planDays.indexOf(hoveredDay) * (800 / (planDays.length - 1 || 1))) - 60"
                                    [style.bottom.px]="150">
                                    <div class="tooltip-header">{{ hoveredDay.dateObj | date:'MM/dd/yyyy' }}</div>
                                    <div class="tooltip-row green">Work you logged on this day: -</div>
                                    <div class="tooltip-row blue">Target Quota For This Day: {{
                                        hoveredDay.workToComplete }}</div>
                                </div>
                            </div>
                            <div class="legend">
                                <span class="dot target"></span> Target Daily
                            </div>
                        </div>

                        <div class="chart-container mt-8">
                            <h3 class="chart-title">Overall Progress</h3>
                            <div class="svg-container">
                                <svg viewBox="0 0 800 200" preserveAspectRatio="none" class="chart-svg">
                                    <!-- Grid Lines -->
                                    <line *ngFor="let line of getGridLines(targetWordCount)" x1="0"
                                        [attr.y1]="getYPos(line, targetWordCount)" x2="800"
                                        [attr.y2]="getYPos(line, targetWordCount)" class="grid-line"></line>

                                    <path [attr.d]="getCumulativePath()" fill="none" class="progress-path"></path>

                                    <!-- Data Dots -->
                                    <circle *ngFor="let pt of getCumulativePoints()" [attr.cx]="pt.x" [attr.cy]="pt.y"
                                        r="4" class="data-dot" (mouseenter)="hoveredDay = pt.day"
                                        (mouseleave)="hoveredDay = null"></circle>
                                </svg>

                                <div class="chart-axes">
                                    <div class="y-axis">
                                        <span *ngFor="let line of getGridLines(targetWordCount).reverse()"
                                            class="axis-label">{{ line | number:'1.0-1' }}</span>
                                    </div>
                                    <div class="x-axis">
                                        <ng-container *ngFor="let day of planDays; let i = index">
                                            <span *ngIf="i % (totalDays > 10 ? 3 : 1) === 0" class="axis-label">{{
                                                day.dateObj
                                                | date:'yyyy-MM-dd' }}</span>
                                        </ng-container>
                                    </div>
                                </div>
                            </div>
                            <div class="legend">
                                <span class="dot progress"></span> Cumulative Progress
                            </div>
                        </div>
                    </div>

                    <!-- Bar View -->
                    <div *ngSwitchCase="'Bar'" class="view-card bar-view">
                        <div class="chart-container">
                            <h3>Daily Workload</h3>
                            <div class="bar-chart">
                                <div *ngFor="let day of planDays" class="bar-wrapper"
                                    [title]="day.date + ': ' + day.workToComplete + ' words'">
                                    <div class="bar" [style.height.%]="(day.workToComplete / getMaxDailyTarget()) * 100"
                                        [style.background]="dashboardColor"></div>
                                    <span class="bar-label">{{ day.num }}</span>
                                </div>
                            </div>
                            <div class="chart-axes">
                                <div class="y-axis">
                                    <span>{{ getMaxDailyTarget() | number }}</span>
                                    <span>{{ (getMaxDailyTarget() / 2) | number }}</span>
                                    <span>0</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Progress Tab View -->
            <div *ngIf="viewMode === 'progress'" class="progress-view-content">
                <div class="progress-summary-header">
                    <p>{{ targetWordCount | number }} words over {{ totalDays }} days ({{ getFormattedDateRange() }})
                    </p>
                    <button class="btn-save-progress" (click)="saveProgress()">Save Progress</button>
                </div>

                <div class="progress-updates-card">
                    <div class="progress-updates-header">
                        <button class="btn-add-progress" (click)="addProgressEntry()">
                            <i class="fas fa-calendar-plus"></i> Add Progress
                        </button>
                        <div class="header-columns">
                            <span class="col-target">Target Lines</span>
                            <span class="col-overall">Overall Progress ({{ progressEntries.length }} updates)</span>
                            <span class="col-notes">Notes & Time</span>
                        </div>
                    </div>

                    <div class="progress-entries-list">
                        <div *ngFor="let entry of progressEntries" class="progress-entry-row"
                            [class.today-row]="entry.isToday">
                            <div class="date-col">
                                <span class="date-text">
                                    <ng-container *ngIf="entry.isToday">TODAY, </ng-container>
                                    {{ entry.date | date:'EEEE, MMM d' }}
                                    <ng-container
                                        *ngIf="entry.date.getDate() === 1 || entry.date.getDate() === 21 || entry.date.getDate() === 31">st</ng-container>
                                    <ng-container
                                        *ngIf="entry.date.getDate() === 2 || entry.date.getDate() === 22">nd</ng-container>
                                    <ng-container
                                        *ngIf="entry.date.getDate() === 3 || entry.date.getDate() === 23">rd</ng-container>
                                    <ng-container
                                        *ngIf="![1,2,3,21,22,23,31].includes(entry.date.getDate())">th</ng-container>
                                </span>
                                <i class="fas fa-plus-circle add-icon"></i>
                            </div>
                            <div class="target-col">{{ entry.targetWords | number }}</div>
                            <div class="input-col">
                                <input type="number" [(ngModel)]="entry.actualWords" placeholder="Update me!">
                            </div>
                            <div class="notes-col">
                                <i class="fas fa-clipboard notes-icon"></i>
                            </div>
                            <div class="action-col">
                                <i class="fas fa-times-circle delete-icon" (click)="removeProgressEntry(entry.id)"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Stats Tab View -->
            <div *ngIf="viewMode === 'stats'" class="stats-view-content">
                <div class="stats-top-actions">
                    <a href="javascript:void(0)" class="learn-more">
                        <i class="fas fa-info-circle"></i> Learn More About Stats
                    </a>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value">{{ dailyAvg | number }}</div>
                        <div class="stat-label">Daily Avg Words <i class="fas fa-star"></i></div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">{{ weeklyAvg | number }}</div>
                        <div class="stat-label">Weekly Avg Words <i class="fas fa-star"></i></div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">{{ weekdayAvg | number }}</div>
                        <div class="stat-label">Weekday Avg Words <i class="fas fa-star"></i></div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">{{ weekendAvg | number }}</div>
                        <div class="stat-label">Weekend Avg Words <i class="fas fa-star"></i></div>
                    </div>
                </div>
            </div>
        </main>
    </div>
</div>